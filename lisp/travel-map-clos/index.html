<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>旅行, 地图, CLOG 以及 CLOS | My Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="旅行, 地图, CLOG 以及 CLOS" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="About 暑假已经被各种活预支得差不多了, 剩下的那么点时间打算全拿去玩. 出去旅游还是要做些小小的计划的吧, 于是看到了懒猫大佬做的一个地图 (EAF 旅游规划地图应用, GitHub: EAF Map). 开源技术方案参考: 地图元素绘制: leaflet.js 当前经纬地址: HTML5 Navigator GeoLocation 地址名称搜索: geopy 高速路径查询: http://router.project-osrm.org 最优路径规划: python-tsp, numpy from EAF 旅游规划地图应用 (Emacs China) 看了看方案说明, 感觉可以理解并且也不是非常庞大, 于是想着试试看做一下. 刚好试试练习一下最近接触的 CLOG 以及 CLOS. 注: 本文是边写程序边记录的一个类似于写码小吐槽的东西吧. 写了一大半之后发现完全没有任何的逻辑和章法, 总之就是超级乱. 如果最终可能的话, 我大概整理一下发布. (虽然按照我的尿性, 估计是不能了). 使用的技术的简单说明 Common Lisp 你说的对, 但是 Common Lisp 是一门非常强大和先进的函数式编程语言. 它拥有极其灵活和丰富的语法, 支持宏系统, 闭包, 高阶函数, 泛型函数等特性. Common Lisp 有着悠久的历史, 影响了许多现代编程语言的设计, 它拥有强大的标准库和活跃的社区. 虽然 Common Lisp 不如其他语言流行, 但它在人工智能, 金融等领域仍有应用. 总的来说, Common Lisp 是一门优雅, 高效, 富有表现力的编程语言, 值得每一位程序员去学习和探索. Generated by Claude via Slack 一些注记 按照 ANSI 标准, Common Lisp 是一门面向对象的编程语言 (来源, 可能是指 &#8220;These new goals included stricter standardization for portability, an object-oriented programming system, a condition system, iteration facilities, and a way to handle large character sets.&#8221; HyperSpec) 并且忘了在哪里看到的, Common Lisp 并不是一门纯函数式的编程语言. 或者说, 它不只能够函数式编程, 所以只把它看作是函数式语言也是不太合理的. 标准库之类的, 感觉大多数的库都非常的硬核, 比我年龄都大的库, 十多年前停止更新还能跑的库&#8230; 人工智能应该并没有了, 金融, 应该是被 Clojure 吧&#8230; 不过我不是很了解. 并且 Lisp 应该并不是只有这样的专家系统的逻辑人工智能吧. CLOG CLOG The Common Lisp Omnificent GUI, 是一个依托网页技术的 Common Lisp 图形交互界面库. 不过我确实可以稍微理解一些那些想要用 JavaScript 来写各种后端程序的想法: 毕竟 UI 可以用 Electron 这样的巨大玩意来用网页折腾, &#8220;写网页为啥不用 JS&#8221;, 大概就是这样的想法吧&#8230; Leaflet 一个 JS 的地图库, 可以往网页里面插入地图显示. 我目前的想法是这样的: 用 CLOG 给 Leaflet 写一个 Wrapper, 然后将其嵌入到之后的使用之中. 注: 在构建该部分代码的时候, 主要参考的是 clog-typeahead 项目. 声明库 在 Common Lisp 里面使用 ASDF 来进行库 (system) 的定义 在文件 clog-leaflet.asd 中: ;;; clog-leaflet.asd" />
<meta property="og:description" content="About 暑假已经被各种活预支得差不多了, 剩下的那么点时间打算全拿去玩. 出去旅游还是要做些小小的计划的吧, 于是看到了懒猫大佬做的一个地图 (EAF 旅游规划地图应用, GitHub: EAF Map). 开源技术方案参考: 地图元素绘制: leaflet.js 当前经纬地址: HTML5 Navigator GeoLocation 地址名称搜索: geopy 高速路径查询: http://router.project-osrm.org 最优路径规划: python-tsp, numpy from EAF 旅游规划地图应用 (Emacs China) 看了看方案说明, 感觉可以理解并且也不是非常庞大, 于是想着试试看做一下. 刚好试试练习一下最近接触的 CLOG 以及 CLOS. 注: 本文是边写程序边记录的一个类似于写码小吐槽的东西吧. 写了一大半之后发现完全没有任何的逻辑和章法, 总之就是超级乱. 如果最终可能的话, 我大概整理一下发布. (虽然按照我的尿性, 估计是不能了). 使用的技术的简单说明 Common Lisp 你说的对, 但是 Common Lisp 是一门非常强大和先进的函数式编程语言. 它拥有极其灵活和丰富的语法, 支持宏系统, 闭包, 高阶函数, 泛型函数等特性. Common Lisp 有着悠久的历史, 影响了许多现代编程语言的设计, 它拥有强大的标准库和活跃的社区. 虽然 Common Lisp 不如其他语言流行, 但它在人工智能, 金融等领域仍有应用. 总的来说, Common Lisp 是一门优雅, 高效, 富有表现力的编程语言, 值得每一位程序员去学习和探索. Generated by Claude via Slack 一些注记 按照 ANSI 标准, Common Lisp 是一门面向对象的编程语言 (来源, 可能是指 &#8220;These new goals included stricter standardization for portability, an object-oriented programming system, a condition system, iteration facilities, and a way to handle large character sets.&#8221; HyperSpec) 并且忘了在哪里看到的, Common Lisp 并不是一门纯函数式的编程语言. 或者说, 它不只能够函数式编程, 所以只把它看作是函数式语言也是不太合理的. 标准库之类的, 感觉大多数的库都非常的硬核, 比我年龄都大的库, 十多年前停止更新还能跑的库&#8230; 人工智能应该并没有了, 金融, 应该是被 Clojure 吧&#8230; 不过我不是很了解. 并且 Lisp 应该并不是只有这样的专家系统的逻辑人工智能吧. CLOG CLOG The Common Lisp Omnificent GUI, 是一个依托网页技术的 Common Lisp 图形交互界面库. 不过我确实可以稍微理解一些那些想要用 JavaScript 来写各种后端程序的想法: 毕竟 UI 可以用 Electron 这样的巨大玩意来用网页折腾, &#8220;写网页为啥不用 JS&#8221;, 大概就是这样的想法吧&#8230; Leaflet 一个 JS 的地图库, 可以往网页里面插入地图显示. 我目前的想法是这样的: 用 CLOG 给 Leaflet 写一个 Wrapper, 然后将其嵌入到之后的使用之中. 注: 在构建该部分代码的时候, 主要参考的是 clog-typeahead 项目. 声明库 在 Common Lisp 里面使用 ASDF 来进行库 (system) 的定义 在文件 clog-leaflet.asd 中: ;;; clog-leaflet.asd" />
<link rel="canonical" href="/lisp/travel-map-clos/" />
<meta property="og:url" content="/lisp/travel-map-clos/" />
<meta property="og:site_name" content="My Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-07-14T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="旅行, 地图, CLOG 以及 CLOS" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-07-14T00:00:00+00:00","datePublished":"2023-07-14T00:00:00+00:00","description":"About 暑假已经被各种活预支得差不多了, 剩下的那么点时间打算全拿去玩. 出去旅游还是要做些小小的计划的吧, 于是看到了懒猫大佬做的一个地图 (EAF 旅游规划地图应用, GitHub: EAF Map). 开源技术方案参考: 地图元素绘制: leaflet.js 当前经纬地址: HTML5 Navigator GeoLocation 地址名称搜索: geopy 高速路径查询: http://router.project-osrm.org 最优路径规划: python-tsp, numpy from EAF 旅游规划地图应用 (Emacs China) 看了看方案说明, 感觉可以理解并且也不是非常庞大, 于是想着试试看做一下. 刚好试试练习一下最近接触的 CLOG 以及 CLOS. 注: 本文是边写程序边记录的一个类似于写码小吐槽的东西吧. 写了一大半之后发现完全没有任何的逻辑和章法, 总之就是超级乱. 如果最终可能的话, 我大概整理一下发布. (虽然按照我的尿性, 估计是不能了). 使用的技术的简单说明 Common Lisp 你说的对, 但是 Common Lisp 是一门非常强大和先进的函数式编程语言. 它拥有极其灵活和丰富的语法, 支持宏系统, 闭包, 高阶函数, 泛型函数等特性. Common Lisp 有着悠久的历史, 影响了许多现代编程语言的设计, 它拥有强大的标准库和活跃的社区. 虽然 Common Lisp 不如其他语言流行, 但它在人工智能, 金融等领域仍有应用. 总的来说, Common Lisp 是一门优雅, 高效, 富有表现力的编程语言, 值得每一位程序员去学习和探索. Generated by Claude via Slack 一些注记 按照 ANSI 标准, Common Lisp 是一门面向对象的编程语言 (来源, 可能是指 &#8220;These new goals included stricter standardization for portability, an object-oriented programming system, a condition system, iteration facilities, and a way to handle large character sets.&#8221; HyperSpec) 并且忘了在哪里看到的, Common Lisp 并不是一门纯函数式的编程语言. 或者说, 它不只能够函数式编程, 所以只把它看作是函数式语言也是不太合理的. 标准库之类的, 感觉大多数的库都非常的硬核, 比我年龄都大的库, 十多年前停止更新还能跑的库&#8230; 人工智能应该并没有了, 金融, 应该是被 Clojure 吧&#8230; 不过我不是很了解. 并且 Lisp 应该并不是只有这样的专家系统的逻辑人工智能吧. CLOG CLOG The Common Lisp Omnificent GUI, 是一个依托网页技术的 Common Lisp 图形交互界面库. 不过我确实可以稍微理解一些那些想要用 JavaScript 来写各种后端程序的想法: 毕竟 UI 可以用 Electron 这样的巨大玩意来用网页折腾, &#8220;写网页为啥不用 JS&#8221;, 大概就是这样的想法吧&#8230; Leaflet 一个 JS 的地图库, 可以往网页里面插入地图显示. 我目前的想法是这样的: 用 CLOG 给 Leaflet 写一个 Wrapper, 然后将其嵌入到之后的使用之中. 注: 在构建该部分代码的时候, 主要参考的是 clog-typeahead 项目. 声明库 在 Common Lisp 里面使用 ASDF 来进行库 (system) 的定义 在文件 clog-leaflet.asd 中: ;;; clog-leaflet.asd","headline":"旅行, 地图, CLOG 以及 CLOS","mainEntityOfPage":{"@type":"WebPage","@id":"/lisp/travel-map-clos/"},"url":"/lisp/travel-map-clos/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">

  <style type="text/css">
    img {
      margin-left: auto; 
      margin-right:auto; 
      display:block;
    }
  </style><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="My Blog" /><script>
  document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        // customised options
        // • auto-render specific keys, e.g.:
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
        ],
        // • rendering keys, e.g.:
        throwOnError : false
      });
  });
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.23/dist/katex.min.css" integrity="sha384-z91AFMXXGZasvxZz5DtKJse3pKoTPU0QcNFj/B4gDFRmq6Q2bi1StsT7SOcIzLEN" crossorigin="anonymous">

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.23/dist/katex.min.js" integrity="sha384-Af7YmksQNWRLMvro3U9F84xa0paoIu7Pu2niAIUmZoI09Q4aCsbha5dvaj1tHy6K" crossorigin="anonymous"></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.23/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">My Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/categories/">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">旅行, 地图, CLOG 以及 CLOS</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-07-14T00:00:00+00:00" itemprop="datePublished">Jul 14, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1>About</h1>
<p>暑假已经被各种活预支得差不多了, 剩下的那么点时间打算全拿去玩.
  出去旅游还是要做些小小的计划的吧, 于是看到了懒猫大佬做的一个地图
  (<a href="https://emacs-china.org/t/eaf/23772">EAF 旅游规划地图应用</a>, GitHub: <a href="https://github.com/emacs-eaf/eaf-map">EAF Map</a>).</p>
<blockquote>
  <p>开源技术方案参考:</p>
  <ul>
    <li>地图元素绘制: leaflet.js</li>
    <li>当前经纬地址: HTML5 Navigator GeoLocation</li>
    <li>地址名称搜索: geopy</li>
    <li>高速路径查询: http://router.project-osrm.org</li>
    <li>最优路径规划: python-tsp, numpy</li>
  </ul>
  <p>from <a href="https://emacs-china.org/t/eaf/23772">EAF 旅游规划地图应用 (Emacs China)</a></p>
</blockquote>
<p>看了看方案说明, 感觉可以理解并且也不是非常庞大, 于是想着试试看做一下.
  刚好试试练习一下最近接触的 <a href="https://github.com/rabbibotton/clog/tree/main">CLOG</a> 以及 <a href="https://en.wikipedia.org/wiki/Common_Lisp_Object_System">CLOS</a>.</p>
<p>注: 本文是边写程序边记录的一个类似于写码小吐槽的东西吧.
  写了一大半之后发现完全没有任何的逻辑和章法, 总之就是超级乱.
  如果最终可能的话, 我大概整理一下发布. (虽然按照我的尿性, 估计是不能了).</p>
<h1>使用的技术的简单说明</h1>
<h2>Common Lisp</h2>
<blockquote>
  <p>你说的对, 但是 Common Lisp 是一门非常强大和先进的函数式编程语言.
    它拥有极其灵活和丰富的语法, 支持宏系统, 闭包, 高阶函数, 泛型函数等特性.
    Common Lisp 有着悠久的历史, 影响了许多现代编程语言的设计,
    它拥有强大的标准库和活跃的社区. 虽然 Common Lisp 不如其他语言流行,
    但它在人工智能, 金融等领域仍有应用. 总的来说, Common Lisp 是一门优雅,
    高效, 富有表现力的编程语言, 值得每一位程序员去学习和探索.</p>
  <p>Generated by <a href="https://claude.ai">Claude</a> via Slack</p>
</blockquote>
<details><summary> 一些注记 </summary>
<ul>
  <li>按照 ANSI 标准, Common Lisp 是一门面向对象的编程语言 (<a href="https://emacs-china.org/t/lisp/4519">来源</a>,
    可能是指 &#8220;These new goals included stricter standardization for
    portability, an object-oriented programming system, a condition
    system, iteration facilities, and a way to handle large character
    sets.&#8221; <a href="http://www.lispworks.com/documentation/HyperSpec/Body/01_ab.htm">HyperSpec</a>)
    <p>并且忘了在哪里看到的, Common Lisp 并不是一门纯函数式的编程语言.
      或者说, 它不只能够函数式编程, 所以只把它看作是函数式语言也是不太合理的.</p>
  </li>
  <li>标准库之类的, 感觉大多数的库都非常的硬核, 比我年龄都大的库,
    十多年前停止更新还能跑的库&#8230;</li>
  <li>人工智能应该并没有了, 金融, 应该是被 <a href="https://clojure.org">Clojure</a> 吧&#8230; 不过我不是很了解.
    并且 Lisp 应该并不是只有这样的专家系统的逻辑人工智能吧.</li>
</ul>
</details>
<h2>CLOG</h2>
<p><a href="https://github.com/rabbibotton/clog/tree/main">CLOG</a> The Common Lisp Omnificent GUI, 是一个依托网页技术的 Common Lisp
  图形交互界面库. 不过我确实可以稍微理解一些那些想要用 JavaScript
  来写各种后端程序的想法: 毕竟 UI 可以用 Electron 这样的巨大玩意来用网页折腾,
  &#8220;写网页为啥不用 JS&#8221;, 大概就是这样的想法吧&#8230;</p>
<h2>Leaflet</h2>
<p>一个 JS 的地图库, 可以往网页里面插入地图显示. 我目前的想法是这样的:
  用 CLOG 给 Leaflet 写一个 Wrapper, 然后将其嵌入到之后的使用之中.</p>
<p>注: 在构建该部分代码的时候, 主要参考的是 <a href="https://github.com/rabbibotton/clog-typeahead/">clog-typeahead</a> 项目.</p>
<h3>声明库</h3>
<p>在 Common Lisp 里面使用 <a href="https://lispcookbook.github.io/cl-cookbook/systems.html">ASDF</a> 来进行库 (system) 的定义
  在文件 <a href="/_img/lisp/misc/clog-leaflet/clog-leaflet.asd">clog-leaflet.asd</a> 中:</p>
<div class="highlight"><pre><span></span><span class="c1">;;; clog-leaflet.asd</span>

<span class="p">(</span><span class="nf">asdf:defsystem</span><span class="w"> </span><span class="kd">#:clog-leaflet</span>
<span class="w">  </span><span class="nv">:description</span><span class="w"> </span><span class="s">&quot;The CLOG wrapper for Leaflet.&quot;</span>
<span class="w">  </span><span class="nv">:author</span><span class="w"> </span><span class="s">&quot;凉凉 &lt;https://github.com/li-yiyang&gt;&quot;</span>
<span class="w">  </span><span class="nv">:license</span><span class="w"> </span><span class="s">&quot;MIT&quot;</span>
<span class="w">  </span><span class="nv">:version</span><span class="w"> </span><span class="s">&quot;0.0.0&quot;</span>
<span class="w">  </span><span class="nv">:depends-on</span><span class="w"> </span><span class="p">(</span><span class="kd">#:clog</span><span class="p">)</span>
<span class="w">  </span><span class="nv">:components</span><span class="w"> </span><span class="p">((</span><span class="nf">:file</span><span class="w"> </span><span class="s">&quot;clog-leaflet&quot;</span><span class="p">)))</span>
</pre></div>
<p>于是在 <a href="/_img/lisp/misc/clog-leaflet/clog-leaflet.lisp">clog-leaflet.lisp</a> 文件中就可以定义一个对应的包 (系统为包的集合):</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defpackage</span><span class="w"> </span><span class="kd">#:clog-leaflet</span>
<span class="w">  </span><span class="p">(</span><span class="nf">:use</span><span class="w"> </span><span class="kd">#:cl</span><span class="w"> </span><span class="kd">#:clog</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">:export</span><span class="w"> </span><span class="nv">init-leaflet</span><span class="p">))</span>

<span class="p">(</span><span class="nf">in-package</span><span class="w"> </span><span class="nv">:clog-leaflet</span><span class="p">)</span>
</pre></div>
<p>显然, 想要使用 Leaflet, 那么还需要载入对应的库和文件 <code>init-leaflet</code> 吧:</p>
<div class="highlight"><pre><span></span><span class="c1">;;; Implementation - Load Leaflet Lib</span>

<span class="p">(</span><span class="nf">defparameter</span><span class="w"> </span><span class="nv">*leaflet-css-path*</span>
<span class="w">  </span><span class="s">&quot;https://unpkg.com/leaflet@1.9.4/dist/leaflet.css&quot;</span>
<span class="w">  </span><span class="s">&quot;Path/URL to Leaflet CSS file.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defparameter</span><span class="w"> </span><span class="nv">*leaflet-js-path*</span>
<span class="w">  </span><span class="s">&quot;https://unpkg.com/leaflet@1.9.4/dist/leaflet.js&quot;</span>
<span class="w">  </span><span class="s">&quot;Path/URL to Leaflet Javascript file.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defparameter</span><span class="w"> </span><span class="nv">*leaflet-namespace*</span>
<span class="w">  </span><span class="s">&quot;window.LeafletNameSpace&quot;</span>
<span class="w">  </span><span class="s">&quot;Name Space to store the Leaflet objects.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defun</span><span class="w"> </span><span class="nv">init-leaflet</span><span class="w"> </span><span class="p">(</span><span class="nf">body</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;Load the Leaflet Javascripts and opens Leaflet Namespace. </span>
<span class="s">Only called once on first attach.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nf">check-type</span><span class="w"> </span><span class="nv">body</span><span class="w"> </span><span class="nv">clog:clog-obj</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">load-css</span><span class="w">    </span><span class="p">(</span><span class="nf">html-document</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span>
<span class="w">               </span><span class="nv">*leaflet-css-path*</span><span class="w"> </span><span class="nv">:load-only-once</span><span class="w"> </span><span class="nv">T</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">load-script</span><span class="w"> </span><span class="p">(</span><span class="nf">html-document</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span>
<span class="w">               </span><span class="nv">*leaflet-js-path*</span><span class="w">  </span><span class="nv">:load-only-once</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">:wait-for-load</span><span class="w"> </span><span class="nv">NIL</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">js-execute</span><span class="w"> </span><span class="nv">body</span><span class="w"> </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A = {};&quot;</span><span class="w"> </span><span class="nv">*leaflet-namespace*</span><span class="p">)))</span>
</pre></div>
<details><summary> 对 init-leaflet 的说明 </summary>
<ul>
  <li><code>load-css</code> 和 <code>load-script</code> 即为 <a href="https://leafletjs.com/examples/quick-start/">Preparing your page | Leaflet</a> 中的说明,
    但是这里有一个比较麻烦的地方就是, 在 CLOG 中的 <code>load-script</code> 是非阻塞的&#8230;
    <p>可以猜猜看这会导致啥坑呢&#8230; 答案是: 如果在 <code>load-script</code> 之后,
      立刻执行和载入的库相关的函数, 可能并不会如你所愿 &#8211; 因为还没加载呢&#8230;</p>
    <p>注: 但是没道理啊&#8230; 查文档可以知道, 对于 <code>load-script</code> 有一个 key:
      <code>wait-for-load</code>, 可以等待加载完毕再返回值&#8230;
      不知道为什么之前会出现那样的 bug.</p>
    <p>哦, 一个难绷的地方出现了, 我竟然要将 <code>:wait-for-load</code> 设为 <code>NIL</code> 才能等待加载.
      稍微有一些反直觉了属于是.</p>
  </li>
  <li>以及在 <code>load-css</code> 和 <code>load-script</code> 中, 实际上还可以载入本地的文件,
    一想到这个, 在一车小孩里面写代码的我就很生气&#8230; 为什么我一开始要用在线资源&#8230;
    现在高铁一直在过山洞, 就因为卡在这个地方所以导致我直接没法继续了.
    <p>所以开摆, 刚好下了点 (指约 20G 的) 番. 有理有据.</p>
  </li>
  <li><code>js-execute</code> 的代码: 大概是这么实现的: <a href="https://github.com/rabbibotton/clog/blob/6302deb6e699cc403d4339aa0c215e809a809a9e/source/clog-base.lisp#L98">js-execute</a> 通过
    <a href="https://github.com/rabbibotton/clog/blob/6302deb6e699cc403d4339aa0c215e809a809a9e/source/clog-connection.lisp#L631">clog-connection:execute</a> 中的 <code>websocket-driver:send</code> 的方法来和前端发信,
    然后前端通过 <a href="https://github.com/rabbibotton/clog/blob/main/static-files/js/boot.js">boot.js</a> 来进行相应的一个操作吧.
    <p>但是这样就可能会出现因为执行环境是局域环境而没法定义全局变量来用了.
      <del>大概原理是这样吧&#8230;</del> 简单来说就是对于:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">js-execute</span><span class="w"> </span><span class="nv">body</span><span class="w"> </span><span class="s">&quot;var x = 0;&quot;</span><span class="p">)</span>
<span class="c1">;; codes</span>
<span class="p">(</span><span class="nf">js-execute</span><span class="w"> </span><span class="nv">body</span><span class="w"> </span><span class="s">&quot;console.log(x);&quot;</span><span class="p">)</span>
</pre></div>
    <p>这样的代码并不能实现 (报错为 <i>Can't find variable: x</i>)</p>
    <p>我的一个比较投机取巧的解决方法就是在 <code>window</code> 里面放变量,
      但是可能不一定好使就是了.</p>
  </li>
</ul>
</details>
<h3>CLOG-Leaflet 的设计</h3>
<details><summary> 一个菜鸟的瞎说 </summary>
<ul>
  <li>在学习的时候, 感觉大部分的时候都是一种 &#8220;非常细微&#8221; 的 JRPG 的感觉:
    比如把一个东西分类, 然后再细分变成了非常简单的一个东西.
    于是学习就变成了听着 NPC 的鬼话先去定义了一个叫登龙剑的变量,
    然后做了一个平 A 挥击的函数.
    <p>虽然也不是说坏吧, 毕竟细节和各种东西都掌握得很好. 只是这么做了下去,
      就感觉挺没意思的. <del>能在海拉鲁大地耍流氓, 谁救塞尔达啊</del></p>
  </li>
  <li>但是看了一些大佬在设计程序的时候, 往往干的事情不是解决 JRPG 里面的问题,
    而是构造 JRPG 的一个框架的感觉. 比如可以参考 <a href="https://github.com/emacs-eaf/emacs-application-framework/blob/master/README.zh-CN.md">EAF</a> 的框架设计,
    以及 <a href="https://github.com/manateelazycat/lsp-bridge">lsp-bridge</a> 的一个构造 (没错, 两个都是 <a href="https://github.com/manateelazycat">懒猫</a> 大佬的框架).
    <p>估计以后可以往这些角度去思考, 拿到一个问题, 该怎么分解&#8230;</p>
  </li>
</ul>
</details>
<p>这里应当先思考该如何制作一个 CLOG-Leaflet 的一个框架,
  先思考一下我有啥需求:</p>
<ul>
  <li>我需要构造一个 <code>clog-leaflet-map</code>,
    因为 Leaflet 相当于是在一个 <code>div</code> 元素上绑定一个地图元素,
    所以我想要这样的对象应当有基本的 <code>div</code> 的操作,
    并且还要提供 Leaflet 的接口.
    <p>于是一个比较合理的想法就是, 令 <code>clog-leaflet-map</code> 为
      <a href="https://rabbibotton.github.io/clog/clog-manual.html#CLOG:CLOG-DIV%20CLASS">clog-div</a> 的一个子类.</p>
  </li>
  <li>为了绘制一个地图, 需要指定的量:
    <ul>
      <li>地图储存的 <code>div</code> 的 ID</li>
      <li>地图视点的中心 <a href="https://leafletjs.com/reference.html#map-center">center</a>, 地图的缩放量 <a href="https://leafletjs.com/reference.html#map-zoom">zoom</a></li>
      <li>地图的 <a href="https://leafletjs.com/reference.html#map-layers">layers</a> 来指定 <a href="https://leafletjs.com/reference.html#tilelayer">Tile Layer</a></li>
    </ul>
  </li>
  <li>其他的需求为在图上做标记 <a href="https://leafletjs.com/reference.html#marker">Marker</a>, 对于一个标记, 需要指定的量:
    <ul>
      <li>可以指定一个 <a href="https://leafletjs.com/reference.html#popup">Popup</a> 来说明点击弹出的量</li>
    </ul>
  </li>
</ul>
<p>那么如果就是这么简单的话, 只需要构建几个类即可:</p>
<h4>Helper Functions</h4>
<p>之前试过一些 ClojureScript 的代码, 感觉里面的一些注记符号和小函数还是很方便的,
  比如如果想要把一些将 Common Lisp 中的值转换为 JS 的值的转换函数,
  方便使用 <code>js-execute</code>:</p>
<div class="highlight"><pre><span></span><span class="c1">;;; Helper Function</span>

<span class="p">(</span><span class="nf">defgeneric</span><span class="w"> </span><span class="nv">-&gt;js</span><span class="w"> </span><span class="p">(</span><span class="nf">obj</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">:documentation</span><span class="w"> </span><span class="s">&quot;Convert basic Common Lisp Datatype into JS data.&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defmethod</span><span class="w"> </span><span class="nv">-&gt;js</span><span class="w"> </span><span class="p">(</span><span class="nf">obj</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;Default will be simply FORMAT function.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A&quot;</span><span class="w"> </span><span class="nv">obj</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defmethod</span><span class="w"> </span><span class="nv">-&gt;js</span><span class="w"> </span><span class="p">((</span><span class="nf">obj</span><span class="w"> </span><span class="nb">string</span><span class="p">))</span>
<span class="w">  </span><span class="s">&quot;Trun String into JS String.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~S&quot;</span><span class="w"> </span><span class="nv">obj</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defmethod</span><span class="w"> </span><span class="nv">-&gt;js</span><span class="w"> </span><span class="p">((</span><span class="nf">obj</span><span class="w"> </span><span class="nb">list</span><span class="p">))</span>
<span class="w">  </span><span class="s">&quot;Trun List into JS Array.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;[~A]&quot;</span>
<span class="w">          </span><span class="p">(</span><span class="nb">reduce</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">converted</span><span class="w"> </span><span class="nv">new</span><span class="p">)</span>
<span class="w">                    </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A, ~A&quot;</span><span class="w"> </span><span class="nv">converted</span><span class="w">  </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="nv">new</span><span class="p">)))</span>
<span class="w">                  </span><span class="p">(</span><span class="nf">rest</span><span class="w"> </span><span class="nv">obj</span><span class="p">)</span><span class="w"> </span><span class="nv">:initial-value</span><span class="w"> </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="nv">obj</span><span class="p">)))))</span>

<span class="p">(</span><span class="nf">defun</span><span class="w"> </span><span class="nv">plist-&gt;js</span><span class="w"> </span><span class="p">(</span><span class="nf">plst</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;Convert plist (:p v) into JS code {p: v}.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nf">declare</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">plst</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nf">labels</span><span class="w"> </span><span class="p">((</span><span class="nf">iter</span><span class="w"> </span><span class="p">(</span><span class="nf">lst</span><span class="p">)</span>
<span class="w">             </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">null</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
<span class="w">                 </span><span class="s">&quot;&quot;</span>
<span class="w">                 </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A: ~A, ~A&quot;</span>
<span class="w">                         </span><span class="p">(</span><span class="nb">string-downcase</span><span class="w"> </span><span class="p">(</span><span class="nb">string</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="nv">lst</span><span class="p">)))</span>
<span class="w">                         </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="p">(</span><span class="nb">second</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
<span class="w">                         </span><span class="p">(</span><span class="nf">iter</span><span class="w"> </span><span class="p">(</span><span class="nb">cddr</span><span class="w"> </span><span class="nv">lst</span><span class="p">))))))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;{~A}&quot;</span><span class="w"> </span><span class="p">(</span><span class="nf">iter</span><span class="w"> </span><span class="nv">plst</span><span class="p">))))</span>
</pre></div>
<h4>CLOG-Leaflet-Map</h4>
<h5>CLOG-Leaflet-Map 类定义</h5>
<p>定义一个继承自 <code>clog-div</code> 的类, 以及其对应的一堆功能:</p>
<div class="highlight"><pre><span></span><span class="c1">;;; Implementation - clog-leaflet-map</span>

<span class="p">(</span><span class="nf">defclass</span><span class="w"> </span><span class="nv">clog-leaflet-map</span><span class="w"> </span><span class="p">(</span><span class="nf">clog-div</span><span class="p">)</span>
<span class="w">  </span><span class="p">((</span><span class="nf">options</span><span class="w"> </span><span class="nv">:initarg</span><span class="w"> </span><span class="nv">:options</span>
<span class="w">            </span><span class="nv">:initform</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">:latitute</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">:longtitute</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">:zoom</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="nv">:reader</span><span class="w"> </span><span class="nv">options</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nf">:documentation</span><span class="w"> </span><span class="s">&quot;Leaflet map Object. &quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defgeneric</span><span class="w"> </span><span class="nv">create-leaflet-map</span><span class="w"> </span><span class="p">(</span><span class="nf">clog-obj</span><span class="w"> </span><span class="nv">&amp;key</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="nv">style</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">html-id</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">:documentation</span><span class="w"> </span><span class="s">&quot;Create a new clog-leaflet-map as child of CLOG-OBJ.&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defmethod</span><span class="w"> </span><span class="nv">create-leaflet-map</span><span class="w"> </span><span class="p">((</span><span class="nf">obj</span><span class="w"> </span><span class="nv">clog:clog-obj</span><span class="p">)</span>
<span class="w">                               </span><span class="nv">&amp;key</span><span class="w"> </span><span class="p">(</span><span class="nf">options</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">:zoom</span><span class="w"> </span><span class="mi">13</span>
<span class="w">                                               </span><span class="nv">:center</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>
<span class="w">                                 </span><span class="p">(</span><span class="nf">style</span><span class="w"> </span><span class="nv">NIL</span><span class="p">)</span>
<span class="w">                                 </span><span class="p">(</span><span class="nf">class</span><span class="w"> </span><span class="nv">NIL</span><span class="p">)</span>
<span class="w">                                 </span><span class="p">(</span><span class="nf">html-id</span><span class="w"> </span><span class="nv">NIL</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">new-div</span><span class="w"> </span><span class="p">(</span><span class="nf">create-div</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">:html-id</span><span class="w"> </span><span class="nv">html-id</span>
<span class="w">                                 </span><span class="nv">:class</span><span class="w"> </span><span class="nv">class</span>
<span class="w">                                 </span><span class="nv">:style</span><span class="w"> </span><span class="nv">style</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nf">setf</span><span class="w"> </span><span class="p">(</span><span class="nf">width</span><span class="w"> </span><span class="nv">new-div</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;400px&quot;</span>
<span class="w">          </span><span class="p">(</span><span class="nf">height</span><span class="w"> </span><span class="nv">new-div</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;400px&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nf">attach-leaflet-map</span><span class="w"> </span><span class="nv">new-div</span><span class="w"> </span><span class="nv">options</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nf">change-class</span><span class="w"> </span><span class="nv">new-div</span><span class="w"> </span><span class="ss">&#39;clog-leaflet-map</span><span class="p">)))</span>
</pre></div>
<h5>Leaflet Bindings with CLOG-Leaflet-Map 进行一个绑定</h5>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span><span class="w"> </span><span class="nv">attach-leaflet-map</span><span class="w"> </span><span class="p">(</span><span class="nf">obj</span><span class="w"> </span><span class="nv">options</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;Attach Leaflet to OBJ, which should be clog-leaflet-map object.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">id</span><span class="w"> </span><span class="p">(</span><span class="nf">html-id</span><span class="w"> </span><span class="nv">obj</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nf">js-execute</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A[&#39;MAP~A&#39;] = L.map(&#39;~A&#39;, ~A);&quot;</span>
<span class="w">                            </span><span class="nv">*leaflet-namespace*</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="p">(</span><span class="nf">plist-&gt;js</span><span class="w"> </span><span class="nv">options</span><span class="p">)))))</span>
</pre></div>
<p>可以用一个非常简单的过程来测试一下:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">progn</span>
<span class="w">  </span><span class="p">(</span><span class="nf">initialize</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">body</span><span class="p">)</span>
<span class="w">                </span><span class="p">(</span><span class="nf">init-leaflet</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span>
<span class="w">                </span><span class="p">(</span><span class="nf">create-leaflet-map</span><span class="w"> </span><span class="nv">body</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nf">open-browser</span><span class="p">))</span>
</pre></div>
<details><summary> 其他的一些操作 </summary>
<p>一些辅助函数:</p>
<div class="highlight"><pre><span></span><span class="c1">;;; Helper functions for Leaflet map</span>
<span class="p">(</span><span class="nf">defmethod</span><span class="w"> </span><span class="nv">-&gt;js</span><span class="w"> </span><span class="p">((</span><span class="nf">obj</span><span class="w"> </span><span class="nv">clog-leaflet-map</span><span class="p">))</span>
<span class="w">  </span><span class="s">&quot;Turn OBJ into JS variable name.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A[&#39;MAP~A&#39;]&quot;</span><span class="w"> </span><span class="nv">*leaflet-namespace*</span><span class="w"> </span><span class="p">(</span><span class="nf">html-id</span><span class="w"> </span><span class="nv">obj</span><span class="p">)))</span>
</pre></div>
<p>将 CLOG-Leaflet-Map 的示例转换为其对应的 JavaScript 的变量名来引用.</p>
</details>
<p>于是你应当可以看到如下的一个结果:</p>
<p><img src="/_img/lisp/misc/clog-leaflet/clog-create-leaf-map-screenshot.png" alt="/_img/lisp/misc/clog-leaflet/clog-create-leaf-map-screenshot.png" /></p>
<p>于是接下来的任务就是往里面塞 Tile Layer, 塞 Marker 之类的东西了.</p>
<h4>CLOG-Leaflet-Layer</h4>
<p>我也不知道别的有啥 Tile Layer 的地址, 所以就用示例里面提供的默认的地址,
  为了防止在代码里面出现又臭又长的地址字符串, 所以这里提前定义一下:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defparameter</span><span class="w"> </span><span class="nv">*default-tile-layer-url*</span>
<span class="w">  </span><span class="s">&quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;</span>
<span class="w">  </span><span class="s">&quot;Default Tile Layer URL.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defparameter</span><span class="w"> </span><span class="nv">*default-tile-layer-attribution*</span>
<span class="w">  </span><span class="s">&quot;&amp;copy; &lt;a href=</span><span class="se">\&quot;</span><span class="s">https://www.openstreetmap.org/copyright</span><span class="se">\&quot;</span><span class="s">&gt;OpenStreetMap&lt;/a&gt; contributors&quot;</span>
<span class="w">  </span><span class="s">&quot;Default Tile Layer Attribution.&quot;</span><span class="p">)</span>
</pre></div>
<p>接下来定义 Layer 类:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defclass</span><span class="w"> </span><span class="nv">clog-leaflet-layer</span><span class="w"> </span><span class="p">()</span>
<span class="w">  </span><span class="p">((</span><span class="nf">layer-name</span><span class="w">   </span><span class="nv">:initarg</span><span class="w"> </span><span class="nv">:layer-name</span>
<span class="w">                 </span><span class="nv">:initform</span><span class="w"> </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A[&#39;LAYER~A&#39;]&quot;</span>
<span class="w">                                   </span><span class="nv">*leaflet-namespace*</span>
<span class="w">                                   </span><span class="p">(</span><span class="nb">gensym</span><span class="p">))</span>
<span class="w">                 </span><span class="nv">:accessor</span><span class="w"> </span><span class="nv">layer-name</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="nf">url-template</span><span class="w"> </span><span class="nv">:initarg</span><span class="w"> </span><span class="nv">:url-template</span>
<span class="w">                 </span><span class="nv">:initform</span><span class="w"> </span><span class="nv">*default-tile-layer-url*</span>
<span class="w">                 </span><span class="nv">:reader</span><span class="w"> </span><span class="nv">url-template</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="nf">attribution</span><span class="w">  </span><span class="nv">:initarg</span><span class="w"> </span><span class="nv">:attribution</span>
<span class="w">                 </span><span class="nv">:initform</span><span class="w"> </span><span class="nv">*default-tile-layer-attribution*</span>
<span class="w">                 </span><span class="nv">:reader</span><span class="w"> </span><span class="nv">attribution</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nf">:documentation</span><span class="w"> </span><span class="s">&quot;Tile Layer for Leaflet Map.&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defmethod</span><span class="w"> </span><span class="nv">-&gt;js</span><span class="w"> </span><span class="p">((</span><span class="nf">layer</span><span class="w"> </span><span class="nv">clog-leaflet-layer</span><span class="p">))</span>
<span class="w">  </span><span class="s">&quot;Turn LAYER into JS variable name.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nf">layer-name</span><span class="w"> </span><span class="nv">layer</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defgeneric</span><span class="w"> </span><span class="nv">create-leaflet-layer</span><span class="w"> </span><span class="p">(</span><span class="nf">clog-obj</span><span class="w"> </span><span class="nv">&amp;key</span><span class="w"> </span><span class="nv">url-template</span><span class="w"> </span><span class="nv">attribution</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nf">:documentation</span><span class="w"> </span><span class="s">&quot;Create a new Tile Layer and add to it.&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defmethod</span><span class="w"> </span><span class="nv">create-leaflet-layer</span><span class="w"> </span><span class="p">((</span><span class="nb">map</span><span class="w"> </span><span class="nv">clog-leaflet-map</span><span class="p">)</span>
<span class="w">                                 </span><span class="nv">&amp;key</span><span class="w"> </span><span class="p">(</span><span class="nf">url-template</span><span class="w"> </span><span class="nv">*default-tile-layer-url*</span><span class="p">)</span>
<span class="w">                                   </span><span class="p">(</span><span class="nf">attribution</span><span class="w"> </span><span class="nv">*default-tile-layer-attribution*</span><span class="p">))</span>
<span class="w">  </span><span class="s">&quot;Attach a new Layer for the CLOG-Leaflet-Map object.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nf">layer</span><span class="w"> </span><span class="p">(</span><span class="nf">make-instance</span><span class="w"> </span><span class="ss">&#39;clog-leaflet-layer</span>
<span class="w">                               </span><span class="nv">:url-template</span><span class="w"> </span><span class="nv">url-template</span>
<span class="w">                               </span><span class="nv">:attribution</span><span class="w">  </span><span class="nv">attribution</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nf">js-execute</span><span class="w"> </span><span class="nb">map</span><span class="w">                     </span><span class="c1">; Create and store layer</span>
<span class="w">                </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A = L.tileLayer(&#39;~A&#39;, {attribution: &#39;~A&#39;})&quot;</span>
<span class="w">                        </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="nv">layer</span><span class="p">)</span>
<span class="w">                        </span><span class="p">(</span><span class="nf">url-template</span><span class="w"> </span><span class="nv">layer</span><span class="p">)</span>
<span class="w">                        </span><span class="p">(</span><span class="nf">attribution</span><span class="w"> </span><span class="nv">layer</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nf">js-execute</span><span class="w"> </span><span class="nb">map</span><span class="w">                     </span><span class="c1">; Add Layer to Map</span>
<span class="w">                </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A.addTo(~A);&quot;</span>
<span class="w">                        </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="nv">layer</span><span class="p">)</span>
<span class="w">                        </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="nb">map</span><span class="p">)))</span>
<span class="w">    </span><span class="nv">layer</span><span class="p">))</span>
</pre></div>
<p>于是这个时候的测试代码就变成了:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">progn</span>
<span class="w">  </span><span class="p">(</span><span class="nf">initialize</span>
<span class="w">   </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">body</span><span class="p">)</span>
<span class="w">     </span><span class="p">(</span><span class="nf">init-leaflet</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span>
<span class="w">     </span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nb">map</span><span class="w"> </span><span class="p">(</span><span class="nf">create-leaflet-map</span><span class="w"> </span><span class="nv">body</span><span class="p">))</span>
<span class="w">            </span><span class="p">(</span><span class="nf">layer</span><span class="w"> </span><span class="p">(</span><span class="nf">create-leaflet-layer</span><span class="w"> </span><span class="nb">map</span><span class="p">)))</span>
<span class="w">       </span><span class="p">(</span><span class="nf">setf</span><span class="w"> </span><span class="nv">*map*</span><span class="w">   </span><span class="nb">map</span>
<span class="w">             </span><span class="nv">*layer*</span><span class="w"> </span><span class="nv">layer</span><span class="p">)))))</span>
</pre></div>
<p>(注: 其中用了两个外部变量来帮助我调试. )</p>
<p>你应该能够看到类似的结果:</p>
<p><img src="/_img/lisp/misc/clog-leaflet/clog-add-tile-layer-screenshot.png" alt="/_img/lisp/misc/clog-leaflet/clog-add-tile-layer-screenshot.png" /></p>
<h4>接下来慢慢添加一些标记类</h4>
<p>理论上来说应该就可以开始写一些功能性的代码了, 不过现在无所谓.
  更加具体的代码我觉得还是写一个小小仓库来包装一下吧.</p>
<h3>MACROS 赛高!</h3>
<p>在尝试写 Wrapper 的时候, 遇到了一个很无聊的事情,
  就是我发现有很多无聊的代码都要重复构造, 这样就比较烦.</p>
<p>突然发现, 如果我写一个 MACROS 来自动帮我构代码的话,
  那么岂不是非常的方便?</p>
<p>不过我是刚开始接触类似的做法, 并不是很会, 可能写出的结果并不是很漂亮.</p>
<h4>需求</h4>
<p>我发现我需要经常写如下的代码:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">js-execute</span><span class="w"> </span><span class="nb">map</span><span class="w"> </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A.setView(~A)&quot;</span>
<span class="w">                        </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="nb">map</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="nv">center</span><span class="p">)</span><span class="w"> </span><span class="o">...</span><span class="p">))</span>
</pre></div>
<p>并且这些代码基本都是一样的, 这就让我构造代码的时候感到很无聊,
  毕竟这个时候就变成了我在抄写文档的感觉了. 并且抄得多, 功能还少,
  这可太亏了.</p>
<p>于是我决定写一个 MACRO, 其应当可以快速地生成下面的代码.</p>
<h4>实现</h4>
<p>需要实现的核心功能是生成: <code>&lt;OBJ&gt;.&lt;JS-METHOD&gt;(&lt;PARAMETERS&gt;)</code> 这样的 JS 调用.
  那么需要生成的模版应该如下: =&#8221;~A.&lt;JS-METHOD&gt;(~A, ~A, &#8230;)&#8221;= 这样模版.</p>
<p>在调用的形式上, 我希望能够越简单越好, 比如说:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">generate-js-wrapper</span>
<span class="w"> </span><span class="nv">clog-leaflet-map</span>
<span class="w"> </span><span class="p">(</span><span class="nf">set-zoom</span><span class="w"> </span><span class="p">(</span><span class="nf">zoom</span><span class="p">)</span>
<span class="w">           </span><span class="nv">:documentation</span><span class="w"> </span><span class="s">&quot;Set zoom.&quot;</span><span class="p">)</span>
<span class="w"> </span><span class="p">(</span><span class="nf">set-view</span><span class="w"> </span><span class="p">(</span><span class="nf">center</span><span class="w"> </span><span class="nv">zoom</span><span class="p">)</span>
<span class="w">           </span><span class="nv">:documentation</span><span class="w"> </span><span class="s">&quot;Set view.&quot;</span>
<span class="w">           </span><span class="nv">:js-name</span><span class="w"> </span><span class="s">&quot;setView&quot;</span><span class="p">))</span>
</pre></div>
<p>于是形式应该变成类似于 <code>(defmacro generate-js-wrapper (class &amp;rest definitions))</code>,
  然后对于 <code>definitions</code> 中的形式应为 <code>(method paras . options)</code>.</p>
<p>那么问题应当提取为:</p>
<ul>
  <li>从 <code>definitions</code> 提取信息</li>
  <li>然后构造函数定义</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">defmacro</span><span class="w"> </span><span class="nv">generate-js-wrapper</span><span class="w"> </span><span class="p">(</span><span class="nf">class</span><span class="w"> </span><span class="nv">&amp;rest</span><span class="w"> </span><span class="nv">definitions</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;The `DEFINITIONS&#39; should be like:</span>

<span class="s">   ((method-name (parameters) options))</span>

<span class="s">for example, if you want to make a method for `clog-leflet-map&#39;</span>
<span class="s">called `zoom-in&#39;, then you just need to do:</span>

<span class="s">  (generate-js-wrapper &#39;clog-leaflet-map </span>
<span class="s">                        (zoom-in (&amp;optional (ratio 1)) </span>
<span class="s">                          :doc </span><span class="se">\&quot;</span><span class="s">set zoom</span><span class="se">\&quot;</span><span class="s">))</span>

<span class="s">It will be converted into `~A.setZoom(~A)&#39; like code.</span>
<span class="s">The parameters can be just like normal function definition.</span>

<span class="s">For options, they could be:</span>
<span class="s">+ :doc for :documentation</span>
<span class="s">+ :js for JavaScript method call</span>

<span class="s">This macro is in early stage and it is limited.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nf">labels</span>
<span class="w">      </span><span class="p">((</span><span class="nf">generate</span><span class="w"> </span><span class="p">(</span><span class="nf">definition</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nf">method</span><span class="w">  </span><span class="p">(</span><span class="nb">first</span><span class="w">  </span><span class="nv">definition</span><span class="p">))</span>
<span class="w">                </span><span class="p">(</span><span class="nf">paras</span><span class="w">   </span><span class="p">(</span><span class="nb">second</span><span class="w"> </span><span class="nv">definition</span><span class="p">))</span>
<span class="w">                </span><span class="p">(</span><span class="nf">options</span><span class="w"> </span><span class="p">(</span><span class="nb">cddr</span><span class="w">   </span><span class="nv">definition</span><span class="p">))</span>
<span class="w">                </span><span class="p">(</span><span class="nf">flat-para</span><span class="w"> </span><span class="p">(</span><span class="nf">loop</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">para</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">paras</span>
<span class="w">                                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">listp</span><span class="w"> </span><span class="nv">para</span><span class="p">)</span>
<span class="w">                                   </span><span class="nv">collect</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="nv">para</span><span class="p">)</span>
<span class="w">                                 </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nf">eq</span><span class="w"> </span><span class="nv">para</span><span class="w"> </span><span class="ss">&#39;&amp;optional</span><span class="p">))</span>
<span class="w">                                              </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nf">eq</span><span class="w"> </span><span class="nv">para</span><span class="w"> </span><span class="ss">&#39;&amp;key</span><span class="p">)))</span>
<span class="w">                                        </span><span class="nv">collect</span><span class="w"> </span><span class="nv">para</span><span class="p">))</span>
<span class="w">                </span><span class="p">(</span><span class="nf">js-name</span><span class="w"> </span><span class="p">(</span><span class="nf">getf</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="nv">:js</span><span class="w"> </span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="nv">method</span><span class="p">)))</span>
<span class="w">                </span><span class="p">(</span><span class="nf">docstr</span><span class="w">  </span><span class="p">(</span><span class="nf">getf</span><span class="w"> </span><span class="nv">options</span><span class="w"> </span><span class="nv">:doc</span>
<span class="w">                               </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;&lt;~A&gt;.~A~A&quot;</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">js-name</span>
<span class="w">                                       </span><span class="p">(</span><span class="nf">wrapper</span><span class="w"> </span><span class="nv">flat-para</span>
<span class="w">                                                </span><span class="nv">:left</span><span class="w"> </span><span class="s">&quot;(&quot;</span>
<span class="w">                                                </span><span class="nv">:right</span><span class="w"> </span><span class="s">&quot;)&quot;</span><span class="p">)))))</span>
<span class="w">           </span><span class="o">`</span><span class="p">((</span><span class="nf">defgeneric</span><span class="w"> </span><span class="o">,</span><span class="nv">method</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="ss">&#39;obj</span>
<span class="w">                                   </span><span class="p">(</span><span class="nf">mapcar</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">para</span><span class="p">)</span>
<span class="w">                                             </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">listp</span><span class="w"> </span><span class="nv">para</span><span class="p">)</span>
<span class="w">                                                 </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="nv">para</span><span class="p">)</span>
<span class="w">                                                 </span><span class="nv">para</span><span class="p">))</span>
<span class="w">                                    </span><span class="nv">paras</span><span class="p">))</span>
<span class="w">               </span><span class="p">(</span><span class="nf">:documentation</span><span class="w"> </span><span class="o">,</span><span class="nv">docstr</span><span class="p">))</span>
<span class="w">             </span><span class="p">(</span><span class="nf">defmethod</span><span class="w"> </span><span class="o">,</span><span class="nv">method</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="ss">&#39;obj</span><span class="w"> </span><span class="nv">class</span><span class="p">)</span><span class="w"> </span><span class="nv">paras</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="nf">js-execute</span>
<span class="w">                </span><span class="nv">obj</span>
<span class="w">                </span><span class="o">,</span><span class="p">(</span><span class="nb">append</span>
<span class="w">                  </span><span class="o">`</span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span>
<span class="w">                           </span><span class="o">,</span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nv">NIL</span><span class="w"> </span><span class="s">&quot;~A.~A~A&quot;</span><span class="w"> </span><span class="s">&quot;~A&quot;</span><span class="w"> </span><span class="nv">js-name</span>
<span class="w">                                    </span><span class="p">(</span><span class="nf">wrapper</span><span class="w"> </span><span class="nv">flat-para</span><span class="w"> </span><span class="nv">:left</span><span class="w"> </span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="nv">:right</span><span class="w"> </span><span class="s">&quot;)&quot;</span>
<span class="w">                                                       </span><span class="nv">:fn</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;~A&quot;</span><span class="p">))))</span>
<span class="w">                  </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="o">`</span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="nv">obj</span><span class="p">)</span>
<span class="w">                        </span><span class="p">(</span><span class="nf">mapcar</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">para</span><span class="p">)</span><span class="w"> </span><span class="o">`</span><span class="p">(</span><span class="nf">-&gt;js</span><span class="w"> </span><span class="o">,</span><span class="nv">para</span><span class="p">))</span><span class="w"> </span><span class="nv">flat-para</span><span class="p">)))))))))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="ss">&#39;progn</span><span class="w"> </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="o">#</span><span class="ss">&#39;append</span><span class="w"> </span><span class="p">(</span><span class="nf">mapcar</span><span class="w"> </span><span class="o">#</span><span class="ss">&#39;generate</span><span class="w"> </span><span class="nv">definitions</span><span class="p">)))))</span>
</pre></div>
<p>大概就是这样, 我现在觉得可以试试看把 <code>&amp;key</code> 定义加到里面去.
  这样估计会更加完善. 但是说不好, 还是暂时不加了.</p>
<h3>The End <del>definitely NOT</del></h3>
<p>接下来的东西我觉得还是扔到 GitHub 上去建一个仓库来折腾一下比较好.
  仓库地址在 <a href="https://github.com/li-yiyang/clog-leaflet">clog-leaflet</a> 这里. 估计会是一个非常简陋的一个仓库吧.</p>
<h2>Nominatim</h2>
<blockquote>
  <p>Nominatim (from the Latin, 'by name') is a tool to search OSM data by name
    and address and to generate synthetic addresses of OSM points (reverse geocoding).</p>
</blockquote>
<p><a href="https://nominatim.org/release-docs/develop/">官方文档</a> 是这么介绍自己的. 这里我的需求就是两点:</p>
<ul>
  <li><a href="https://nominatim.org/release-docs/develop/api/Search/">search</a> 能够根据名称搜索坐标</li>
  <li><a href="https://nominatim.org/release-docs/develop/api/Reverse/">reverse</a> 根据坐标反查</li>
</ul>
<p>在这个时候, 用到的技术栈就是网络访问了. 实际上我感觉这时候做的事情更像是无脑调包,
  毕竟我没有处理网络错误的一些报错, 也没有对得到的数据进行处理之类的事情&#8230;</p>
<p>实际上核心就是一个 GET 方法, 一个函数 <code>fetch</code> 调用, 一个 JSON 解析, 就, 完事了.</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">defun</span><span class="w"> </span><span class="nv">fetch</span><span class="w"> </span><span class="p">(</span><span class="nf">method</span><span class="w"> </span><span class="nv">parameters</span><span class="w"> </span><span class="nv">&amp;key</span><span class="w"> </span><span class="p">(</span><span class="nf">proxy</span><span class="w"> </span><span class="nv">*nominatim-proxy*</span><span class="p">))</span>
<span class="w">  </span><span class="s">&quot;The general fetch method for wrap API usage.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nf">url</span><span class="w"> </span><span class="p">(</span><span class="nf">quri:render-uri</span>
<span class="w">               </span><span class="p">(</span><span class="nf">quri:make-uri</span>
<span class="w">                </span><span class="nv">:defaults</span><span class="w"> </span><span class="nv">*nominatim-host*</span>
<span class="w">                </span><span class="nv">:path</span><span class="w"> </span><span class="nv">method</span>
<span class="w">                </span><span class="nv">:query</span><span class="w"> </span><span class="p">(</span><span class="nf">merge-alist</span><span class="w"> </span><span class="nv">parameters</span><span class="w"> </span><span class="nv">*nominatim-fetch-parameters*</span><span class="p">))))</span>
<span class="w">         </span><span class="p">(</span><span class="nf">res</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">proxy</span>
<span class="w">                  </span><span class="p">(</span><span class="nf">dex:get</span><span class="w"> </span><span class="nv">url</span><span class="w"> </span><span class="nv">:proxy</span><span class="w"> </span><span class="nv">proxy</span><span class="p">)</span>
<span class="w">                  </span><span class="p">(</span><span class="nf">dex:get</span><span class="w"> </span><span class="nv">url</span><span class="p">))))</span>
<span class="w">    </span><span class="p">(</span><span class="nf">yason:parse</span><span class="w"> </span><span class="nv">res</span><span class="p">)))</span>
</pre></div>
<p>其中用到了:</p>
<ul>
  <li><a href="https://github.com/fukamachi/dexador">dexador</a> HTTP client 库</li>
  <li><a href="https://github.com/fukamachi/quri">quri</a> URL 库</li>
  <li><a href="http://phmarek.github.io/yason/">yason</a> JSON 解析库</li>
</ul>
<p>在写完这个部分之后, 我的想法发生了一些微妙的改变, 之前一个小功能一个库的做法,
  让我有一种接下来要干的事情很可能就会变成注水的担忧, 所以我决定将已经建好的库,
  用作这个项目, 而之前写的这些 package, 都作为最终项目 (system) 的子模块.</p>
<p>前面写了的就也懒得改了.</p>
<h2>GeoJSON</h2>
<blockquote>
  <p>GeoJSON is a geospatial data interchange format based on JavaScript
    Object Notation (JSON).  It defines several types of JSON objects and
    the manner in which they are combined to represent data about
    geographic features, their properties, and their spatial extents.
    GeoJSON uses a geographic coordinate reference system, World Geodetic
    System 1984, and units of decimal degrees.</p>
  <p>from <a href="https://datatracker.ietf.org/doc/html/rfc7946">RFC 7946</a></p>
</blockquote>
<p>想法是让 GeoJSON 的对象能够像是 Common Lisp 的对象一样被简单地处理,
  这样的话就比较方便之后写程序去操控了.</p>
<h1>Dowsing Rod</h1>
<p>我决定将 <a href="https://github.com/li-yiyang/dowsing-rod">这个小玩具</a> 命名为 Dowsing Rod (翻译过来为寻龙尺).
  但是我并不咋知道这种伪科学, 最早是在唐人街探案里面的唐仁用的那个东西看到的,
  不是有这样的说法吗? 搞笑角色是无敌的, 所以用寻龙尺这种搞笑名字来命名,
  不是很好玩吗?</p>
<details><summary> 科学和伪科学 </summary>
<p>为啥一个臭学物理的会想找这种伪科学来命名呢?
  这有啥关系, 嘿嘿. 我突然想到我电磁学老师的微信名称: &#8220;永动机&#8221;.</p>
<p>果然就是知道不可能才更加浪漫吗?</p>
</details>
<h2>开发过程中的小小想法</h2>
<ul>
  <li>模块化真爽, 以及模块化的调试的一个简单想法.
    <p>(虽然肯定不会是啥新的东西就是了)</p>
    <ul>
      <li>把功能分割成多个小模块, 每个模块里面就暴露几个核心方法给其他的模块调用.</li>
      <li>开发的时候把 <code>clog-leaflet</code> 这样的 package 命名为 <code>clog-leaflet-dev</code>,
        然后在 <code>clog-leaflet-dev</code> 里面就随便玩了. 在正式使用或者结束的时候,
        就 <code>(delete-package :clog-leaflet-dev)</code> 把模块给删掉.</li>
    </ul>
  </li>
  <li>写图形界面和用户模块真麻烦
    <ul>
      <li>在写用户端函数的时候, 总是有一种万一用户传入了傻逼参数的话该怎么办,
        或者是想要一个类似于超级完美的通用函数, 可以接受任意的参数输入&#8230;
        <p>算了, 就随便乱写吧&#8230;</p>
      </li>
    </ul>
  </li>
  <li>代码的排版和文学编程&#8230;
    <ul>
      <li>因为 Lisp 的语法缘故, 就必然会有层层的嵌套关系, 欸,
        这个时候该怎么设置嵌套和缩进就很难受了. 太长的行看起来就很难受,
        但是换行太多就没法在我的笔记本上看完全部的代码.
        <p>(欸, 屏幕小还得不得不让软件分屏开看参考&#8230;)</p>
      </li>
      <li>文学编程虽然很好, 但是目前我所做的也只是给代码进行分段和分块,
        并标记不同的地方有什么功能, 和一些简单的说明,
        实际上还是没法看出更加吸引人的地方.</li>
    </ul>
  </li>
</ul>

  </div><a class="u-url" href="/lisp/travel-map-clos/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">My Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">My Blog</li><li><a class="u-email" href="mailto:thebigbigwordl@qq.com">thebigbigwordl@qq.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/li-yiyang"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">li-yiyang</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>某不知名的很硬的双非学校的物理系学生的无聊博客</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
